<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/hello-islibra/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/hello-islibra/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/hello-islibra/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/hello-islibra/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/hello-islibra/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/hello-islibra/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/hello-islibra/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Aaron&#39;s horizon">
<meta property="og:url" content="http://islibra.github.io/hello-islibra/page/4/index.html">
<meta property="og:site_name" content="Aaron&#39;s horizon">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Aaron&#39;s horizon">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/hello-islibra/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://islibra.github.io/hello-islibra/page/4/"/>





  <title>Aaron's horizon</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/hello-islibra/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Aaron's horizon</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/hello-islibra/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/hello-islibra/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/16/SQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/16/SQL/" itemprop="url">SQL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-16T14:09:20+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/db/" itemprop="url" rel="index">
                    <span itemprop="name">db</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>Tips:</strong> SQL 对大小写不敏感！</p>
</blockquote>
<h1 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h1><ul>
<li>SELECT 列名称 FROM 表名称<ul>
<li>SELECT <strong>DISTINCT</strong> column1, column2, … FROM table_name;  //去重</li>
<li>SELECT ID <strong>AS</strong> CUSTOMER_ID, NAME <strong>AS</strong> CUSTOMER_NAME FROM CUSTOMERS;  //列别名</li>
<li>SELECT C.ID, C.NAME, C.AGE, O.AMOUNT FROM CUSTOMERS AS C, ORDERS AS O WHERE C.ID = O.CUSTOMER_ID;  //表别名</li>
</ul>
</li>
<li>UPDATE 表名称 SET 列1名称 = 新值1[, 列2名称 = 新值2] WHERE 列名称 = 某值</li>
<li>DELETE FROM 表名称 WHERE 列名称 = 值</li>
<li>INSERT INTO table_name [(列1, 列2,…)] VALUES (值1, 值2,….)</li>
</ul>
<blockquote>
<p><strong>WARNING!</strong> DELETE不加WHERE子句就会删除表中全部数据！</p>
</blockquote>
<h2 id="WHERE子句"><a href="#WHERE子句" class="headerlink" title="WHERE子句"></a>WHERE子句</h2><p>SELECT 列名称 FROM 表名称 <strong>WHERE 列 运算符 值</strong></p>
<h3 id="运算符用法："><a href="#运算符用法：" class="headerlink" title="运算符用法："></a>运算符用法：</h3><ul>
<li>=  !=  &gt;  &gt;=  &lt;  &lt;=，例：<ul>
<li><code>WHERE City=&#39;Beijing&#39;</code></li>
<li><code>WHERE Year&gt;1965</code></li>
</ul>
</li>
<li>BETWEEN，例：<code>SELECT column_name(s) FROM table_name WHERE column_name BETWEEN value1 AND value2;</code>，适用于文本、数值或日期。</li>
<li>LIKE，％ 百分号表示零个，一个或多个字符；_ 下划线表示单个字符；[charlist] 表示字符列中的任一字符；[^charlist]或[!charlist] 表示不在字符列中的任一字符。例：<ul>
<li><code>SELECT * FROM Customers WHERE CustomerName LIKE &#39;a%&#39;;</code></li>
<li><code>SELECT * FROM Customers WHERE CustomerName LIKE &#39;_r%&#39;;</code></li>
<li><code>SELECT * FROM Persons WHERE City NOT LIKE &#39;%lon%&#39;</code></li>
<li><code>SELECT * FROM Persons WHERE City LIKE &#39;[ALN]%&#39;</code>，以A或L或N开头的任意字符串</li>
</ul>
</li>
<li>IS，例：<ul>
<li>测试空值：<code>SELECT column_names FROM table_name WHERE column_name IS [NOT] NULL;</code></li>
</ul>
</li>
<li>IN，例：<code>SELECT column_name(s) FROM table_name WHERE column_name IN (value1,value2,...);</code></li>
</ul>
<blockquote>
<p><strong>Tips:</strong> 文本使用单引号，数值不使用引号！</p>
</blockquote>
<h3 id="AND和OR"><a href="#AND和OR" class="headerlink" title="AND和OR"></a>AND和OR</h3><ul>
<li>SELECT * FROM Persons WHERE FirstName=’Thomas’ AND LastName=’Carter’</li>
<li>SELECT * FROM Persons WHERE firstname=’Thomas’ OR lastname=’Carter’</li>
<li>SELECT * FROM Persons WHERE (FirstName=’Thomas’ OR FirstName=’William’) AND LastName=’Carter’</li>
</ul>
<h2 id="ORDER-BY"><a href="#ORDER-BY" class="headerlink" title="ORDER BY"></a>ORDER BY</h2><p>SELECT 列名称 FROM 表名称 <strong>ORDER BY 列1 [ASC/DESC], 列2 [ASC/DESC]</strong></p>
<h2 id="TOP子句"><a href="#TOP子句" class="headerlink" title="TOP子句"></a>TOP子句</h2><ul>
<li>SQL Server: <code>SELECT TOP number|percent column_name(s) FROM table_name WHERE condition;</code>，例：<ul>
<li>SELECT TOP 2 * FROM Persons</li>
<li>SELECT TOP 50 PERCENT * FROM Persons</li>
</ul>
</li>
<li>MySQL: <code>SELECT column_name(s) FROM table_name LIMIT number;</code>，例：<ul>
<li>SELECT User from user limit 2;  /<em> 只查询2条数据 </em>/</li>
<li>SELECT User from user limit 2,3;  /<em> 从偏移量2开始查询3条数据，偏移量从0开始 </em>/</li>
</ul>
</li>
<li>Oracle: <code>SELECT column_name(s) FROM table_name WHERE ROWNUM &lt;= number;</code></li>
</ul>
<blockquote>
<p><strong>Tips:</strong> 如果只查询一条记录，可以加上LIMIT 1，避免全表扫描。在偏移量大的时候limit执行效率降低，应优先使用where子句，配合limit使用。</p>
</blockquote>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>SELECT function(列) FROM 表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(OrderPrice) <span class="keyword">AS</span> OrderAverage <span class="keyword">FROM</span> Orders;</span><br><span class="line"><span class="keyword">SELECT</span> Customer <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> OrderPrice&gt;(<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(OrderPrice) <span class="keyword">FROM</span> Orders)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(Customer) <span class="keyword">AS</span> CustomerNilsen <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> Customer=<span class="string">'Carter'</span></span><br><span class="line"><span class="comment">/* 类似用法：FIRST\LAST\MAX\MIN\SUM\UCASE\LCASE\LEN */</span></span><br><span class="line"><span class="comment">/* 获取子字符串 */</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MID</span>(City,<span class="number">1</span>,<span class="number">3</span>) <span class="keyword">as</span> SmallCity <span class="keyword">FROM</span> Persons;  <span class="comment">/* SELECT MID(column_name,start[,length]) FROM table_name */</span></span><br><span class="line"><span class="comment">/* 把数值字段舍入为指定的小数位数 */</span></span><br><span class="line"><span class="keyword">SELECT</span> ProductName, <span class="keyword">ROUND</span>(UnitPrice,<span class="number">0</span>) <span class="keyword">as</span> UnitPrice <span class="keyword">FROM</span> Products;  <span class="comment">/* SELECT ROUND(column_name,decimals) FROM table_name */</span></span><br><span class="line"><span class="comment">/* 获取当前时间 */</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NOW</span>() <span class="keyword">FROM</span> table_name;</span><br><span class="line"><span class="comment">/* 格式化 */</span></span><br><span class="line"><span class="keyword">SELECT</span> ProductName, UnitPrice, <span class="keyword">FORMAT</span>(<span class="keyword">Now</span>(),<span class="string">'YYYY-MM-DD'</span>) <span class="keyword">as</span> PerDate <span class="keyword">FROM</span> Products;</span><br></pre></td></tr></table></figure>
<h3 id="GROUP-BY"><a href="#GROUP-BY" class="headerlink" title="GROUP BY"></a>GROUP BY</h3><p>SELECT column_name1, column_name2, aggregate_function(column_name3) FROM table_name GROUP BY column_name1, column_name2;<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Customer,<span class="keyword">SUM</span>(OrderPrice) <span class="keyword">FROM</span> Orders <span class="keyword">GROUP</span> <span class="keyword">BY</span> Customer;</span><br></pre></td></tr></table></figure></p>
<h3 id="HAVING"><a href="#HAVING" class="headerlink" title="HAVING"></a>HAVING</h3><p>WHERE 关键字无法与合计函数一起使用，HAVING 子句对GROUP BY子句过滤。<br>SELECT column_name, aggregate_function(column_name) FROM table_name WHERE column_name operator value GROUP BY column_name HAVING aggregate_function(column_name) operator value;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Customer,<span class="keyword">SUM</span>(OrderPrice) <span class="keyword">FROM</span> Orders <span class="keyword">GROUP</span> <span class="keyword">BY</span> Customer <span class="keyword">HAVING</span> <span class="keyword">SUM</span>(OrderPrice)&lt;<span class="number">2000</span>;</span><br></pre></td></tr></table></figure>
<h2 id="JOIN"><a href="#JOIN" class="headerlink" title="JOIN"></a>JOIN</h2><ul>
<li>[INNER] JOIN: <code>SELECT column_name(s) FROM table_name1 INNER JOIN table_name2 ON table_name1.column_name=table_name2.column_name;</code>，所有表中的数据都匹配（不为空）才会显示。<ul>
<li>例：<code>SELECT Persons.LastName, Persons.FirstName, Orders.OrderNo FROM Persons INNER JOIN Orders ON Persons.Id_P = Orders.Id_P;</code></li>
<li>相当于：<code>SELECT Persons.LastName, Persons.FirstName, Orders.OrderNo FROM Persons, Orders WHERE Persons.Id_P = Orders.Id_P;</code></li>
</ul>
</li>
<li>LEFT [OUTER] JOIN: <code>SELECT column_name(s) FROM table_name1 LEFT JOIN table_name2 ON table_name1.column_name=table_name2.column_name</code>，从左表返回所有的行。</li>
<li>RIGHT [OUTER] JOIN: <code>SELECT column_name(s) FROM table_name1 RIGHT JOIN table_name2 ON table_name1.column_name=table_name2.column_name</code>，从右表返回所有的行。</li>
<li>FULL [OUTER] JOIN: <code>SELECT column_name(s) FROM table_name1 FULL JOIN table_name2 ON table_name1.column_name=table_name2.column_name</code>，返回所有表中的所有行。</li>
</ul>
<h2 id="UNION"><a href="#UNION" class="headerlink" title="UNION"></a>UNION</h2><blockquote>
<p><strong>WARNING!</strong> UNION用于合并两个或多个SELECT语句的结果集，必须拥有相同数量、类型、顺序的列。</p>
</blockquote>
<ul>
<li>UNION: <code>SELECT column_name(s) FROM table_name1 UNION SELECT column_name(s) FROM table_name2;</code>，去除重复值。</li>
<li>UNION ALL: <code>SELECT column_name(s) FROM table_name1 UNION ALL SELECT column_name(s) FROM table_name2;</code>，保留全部值。</li>
</ul>
<blockquote>
<p><strong>Tips1:</strong> 结果集中的列名总是等于 UNION 中第一个 SELECT 语句中的列名。</p>
</blockquote>
<blockquote>
<p><strong>Tips2:</strong> 跨表查询的方法：</p>
<ul>
<li>SELECT column_name(s) FROM table_name WHERE column_name IN (SELECT STATEMENT);</li>
<li>SELECT Orders.OrderID, Customers.CustomerName, Orders.OrderDate FROM Orders INNER JOIN Customers ON Orders.CustomerID=Customers.CustomerID;</li>
<li>SELECT Customers.CustomerName, Orders.OrderID FROM Customers LEFT JOIN Orders ON Customers.CustomerID = Orders.CustomerID ORDER BY Customers.CustomerName;</li>
<li>SELECT Orders.OrderID, Employees.LastName, Employees.FirstName FROM Orders RIGHT JOIN Employees ON Orders.EmployeeID = Employees.EmployeeID ORDER BY Orders.OrderID;</li>
<li>SELECT City, Country FROM Customers WHERE Country=’Germany’ UNION SELECT City, Country FROM Suppliers WHERE Country=’Germany’ ORDER BY City;</li>
</ul>
</blockquote>
<h2 id="复制表数据"><a href="#复制表数据" class="headerlink" title="复制表数据"></a>复制表数据</h2><ul>
<li>SELECT INTO: <code>SELECT column_name(s) INTO new_table_name [IN externaldatabase] FROM old_tablename;</code>，可以使用IN关键字拷贝到另一个数据库中。例：<ul>
<li>SELECT * INTO CustomersBackup2013 FROM Customers WHERE Country=’Germany’;</li>
</ul>
</li>
<li>INSERT INTO SELECT<ul>
<li>INSERT INTO Customers (CustomerName, Country) SELECT SupplierName, Country FROM Suppliers WHERE Country=’Germany’;</li>
</ul>
</li>
</ul>
<h1 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h1><ul>
<li>CREATE DATABASE database_name</li>
<li>ALTER DATABASE</li>
<li>DROP DATABASE database_name</li>
<li>CREATE TABLE Persons<br>(<br>PersonID int,<br>LastName varchar(255),<br>FirstName varchar(255),<br>Address varchar(255),<br>City varchar(255)<br>);</li>
<li>ALTER TABLE<ul>
<li>ALTER TABLE table_name ADD column_name datatype</li>
<li>ALTER TABLE table_name DROP COLUMN column_name</li>
<li>ALTER TABLE table_name ALTER COLUMN column_name datatype，SQL Server</li>
<li>ALTER TABLE table_name MODIFY COLUMN column_name datatype，Oracle</li>
</ul>
</li>
<li>DROP TABLE table_name</li>
<li>CREATE INDEX index_name ON table_name (column_name)</li>
<li><p>DROP INDEX</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Microsoft Access */</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> table_name</span><br><span class="line"><span class="comment">/* MS SQL Server */</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> table_name.index_name</span><br><span class="line"><span class="comment">/* Oracle */</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_name</span><br><span class="line"><span class="comment">/* MySQL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_name</span><br></pre></td></tr></table></figure>
</li>
<li><p>TRUNCATE TABLE table_name，清空表中数据。</p>
</li>
</ul>
<h2 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h2><h3 id="NOT-NULL，字段非空。例："><a href="#NOT-NULL，字段非空。例：" class="headerlink" title="NOT NULL，字段非空。例："></a>NOT NULL，字段非空。例：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="UNIQUE，字段唯一。例："><a href="#UNIQUE，字段唯一。例：" class="headerlink" title="UNIQUE，字段唯一。例："></a>UNIQUE，字段唯一。例：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* MySQL */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">UNIQUE</span> (Id_P)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">P_Id <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 命名 UNIQUE 约束，并为多个列定义 UNIQUE 约束，MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">P_Id <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> uc_PersonID <span class="keyword">UNIQUE</span> (P_Id,LastName)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 增加约束，MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> (Id_P);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uc_PersonID <span class="keyword">UNIQUE</span> (P_Id,LastName)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 撤销 UNIQUE 约束，MySQL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">DROP</span> <span class="keyword">INDEX</span> uc_PersonID</span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> uc_PersonID</span><br></pre></td></tr></table></figure>
<h3 id="PRIMARY-KEY，主键，唯一，非空，有且只有一个主键字段。例："><a href="#PRIMARY-KEY，主键，唯一，非空，有且只有一个主键字段。例：" class="headerlink" title="PRIMARY KEY，主键，唯一，非空，有且只有一个主键字段。例："></a>PRIMARY KEY，主键，唯一，非空，有且只有一个主键字段。例：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* MySQL */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (Id_P)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 命名 PRIMARY KEY 约束，并为多个列定义 PRIMARY KEY 约束，MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> pk_PersonID PRIMARY <span class="keyword">KEY</span> (Id_P,LastName)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 增加主键，MySQL / SQL Server / Oracle / MS Access，增加主键的字段必须在创建表时NOT NULL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span> (Id_P)</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_PersonID PRIMARY <span class="keyword">KEY</span> (Id_P,LastName)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 撤销 PRIMARY KEY 约束，MySQL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span></span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> pk_PersonID</span><br></pre></td></tr></table></figure>
<h3 id="FOREIGN-KEY，外键，指向另一个表中的-PRIMARY-KEY。例："><a href="#FOREIGN-KEY，外键，指向另一个表中的-PRIMARY-KEY。例：" class="headerlink" title="FOREIGN KEY，外键，指向另一个表中的 PRIMARY KEY。例："></a>FOREIGN KEY，外键，指向另一个表中的 PRIMARY KEY。例：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* MySQL */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">Id_O <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">Id_P <span class="built_in">int</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (Id_O),</span><br><span class="line">FOREIGN <span class="keyword">KEY</span> (Id_P) <span class="keyword">REFERENCES</span> Persons(Id_P)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">O_Id <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">P_Id <span class="built_in">int</span> FOREIGN <span class="keyword">KEY</span> <span class="keyword">REFERENCES</span> Persons(P_Id)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 命名 FOREIGN KEY 约束，并为多个列定义 FOREIGN KEY 约束，MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">O_Id <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">P_Id <span class="built_in">int</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (O_Id),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> fk_PerOrders FOREIGN <span class="keyword">KEY</span> (P_Id) <span class="keyword">REFERENCES</span> Persons(P_Id)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 增加 FOREIGN KEY 约束，MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Orders <span class="keyword">ADD</span> FOREIGN <span class="keyword">KEY</span> (Id_P) <span class="keyword">REFERENCES</span> Persons(Id_P)</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Orders <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_PerOrders FOREIGN <span class="keyword">KEY</span> (P_Id) <span class="keyword">REFERENCES</span> Persons(P_Id)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 撤销 FOREIGN KEY 约束，MySQL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Orders <span class="keyword">DROP</span> FOREIGN <span class="keyword">KEY</span> fk_PerOrders</span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Orders <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> fk_PerOrders</span><br></pre></td></tr></table></figure>
<h3 id="CHECK，限制列中的值的范围。例："><a href="#CHECK，限制列中的值的范围。例：" class="headerlink" title="CHECK，限制列中的值的范围。例："></a>CHECK，限制列中的值的范围。例：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* My SQL */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">CHECK</span> (Id_P&gt;<span class="number">0</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">CHECK</span> (Id_P&gt;<span class="number">0</span>),</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 命名 CHECK 约束，并为多个列定义 CHECK 约束，MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> chk_Person <span class="keyword">CHECK</span> (Id_P&gt;<span class="number">0</span> <span class="keyword">AND</span> City=<span class="string">'Sandnes'</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 新增CHECK约束，MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ADD</span> <span class="keyword">CHECK</span> (Id_P&gt;<span class="number">0</span>)</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> chk_Person <span class="keyword">CHECK</span> (Id_P&gt;<span class="number">0</span> <span class="keyword">AND</span> City=<span class="string">'Sandnes'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 撤销 CHECK 约束，MySQL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">DROP</span> <span class="keyword">CHECK</span> chk_Person</span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> chk_Person</span><br></pre></td></tr></table></figure>
<h3 id="DEFAULT，向列中插入默认值。例："><a href="#DEFAULT，向列中插入默认值。例：" class="headerlink" title="DEFAULT，向列中插入默认值。例："></a>DEFAULT，向列中插入默认值。例：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">'Sandnes'</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 自动插入系统值 */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">Id_O <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">Id_P <span class="built_in">int</span>,</span><br><span class="line">OrderDate <span class="built_in">date</span> <span class="keyword">DEFAULT</span> <span class="keyword">GETDATE</span>()</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 新增 DEFAULT 约束，MySQL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ALTER</span> City <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="string">'SANDNES'</span></span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> City <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="string">'SANDNES'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 撤销 DEFAULT 约束，MySQL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ALTER</span> City <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span></span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> City <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span></span><br></pre></td></tr></table></figure>
<h2 id="自增字段"><a href="#自增字段" class="headerlink" title="自增字段"></a>自增字段</h2><blockquote>
<p><strong>Tips:</strong> 自增字段只能有一个，而且必须为键，可以为非主键。</p>
</blockquote>
<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">P_Id <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,  <span class="comment">/* 默认起始值为1，递增1 */</span></span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (P_Id)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 修改起始值 */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons AUTO_INCREMENT=<span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 添加记录时不指定自增字段的值 */</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Persons (FirstName,LastName) <span class="keyword">VALUES</span> (<span class="string">'Bill'</span>,<span class="string">'Gates'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="SQL-Server"><a href="#SQL-Server" class="headerlink" title="SQL Server"></a>SQL Server</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">P_Id <span class="built_in">int</span> PRIMARY <span class="keyword">KEY</span> <span class="keyword">IDENTITY</span>,  <span class="comment">/* 使用IDENTITY(20,10)更改起始值和递增值 */</span></span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 使用序列（ sequence ）对象（该对象生成数字序列）创建自动增量（ auto-increment ）字段。 */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">SEQUENCE</span> seq_person</span><br><span class="line"><span class="keyword">MINVALUE</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">WITH</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">INCREMENT</span> <span class="keyword">BY</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">CACHE</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Persons (<span class="keyword">ID</span>,FirstName,LastName) <span class="keyword">VALUES</span> (seq_person.nextval,<span class="string">'Lars'</span>,<span class="string">'Monsen'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Access"><a href="#Access" class="headerlink" title="Access"></a>Access</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">P_Id <span class="built_in">int</span> PRIMARY <span class="keyword">KEY</span> AUTOINCREMENT,  <span class="comment">/* 使用AUTOINCREMENT(20,10)更改起始值和递增值 */</span></span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><blockquote>
<p><strong>Tips:</strong><br>索引能够提高 SELECT 查询和 WHERE 子句的速度，但是却降低了包含 UPDATE 语句或 INSERT 语句的数据输入过程的速度。<br>创建单列索引还是聚簇索引，要看每次查询中，哪些列在作为过滤条件的 WHERE 子句中最常出现。<br>如果只需要一列，那么就应当创建单列索引。如果作为过滤条件的 WHERE 子句用到了两个或者更多的列，那么聚簇索引就是最好的选择。</p>
</blockquote>
<p>CREATE INDEX index_name on table_name (column1, column2);</p>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>预定义的 SQL 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> CUSTOMERS_VIEW <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="keyword">name</span>, age <span class="keyword">FROM</span> CUSTOMERS <span class="keyword">WHERE</span> age <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> [<span class="keyword">WITH</span> <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>];</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> view_name <span class="keyword">AS</span> <span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> condition;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> view_name;</span><br></pre></td></tr></table></figure>
<h1 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">IF EXISTS (<span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">FROM</span> sysobjects <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'Proc_InsertEmployee'</span> <span class="keyword">AND</span> <span class="keyword">type</span> = <span class="string">'P'</span>) </span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> Proc_InsertEmployee </span><br><span class="line"><span class="keyword">GO</span> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> Proc_InsertEmployee </span><br><span class="line">@PName <span class="keyword">nvarchar</span>(<span class="number">50</span>), </span><br><span class="line">@PSex <span class="keyword">nvarchar</span>(<span class="number">4</span>), </span><br><span class="line">@PAge <span class="built_in">int</span>, </span><br><span class="line">@PWage money </span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line"><span class="keyword">declare</span> @PID <span class="keyword">nvarchar</span>(<span class="number">50</span>) </span><br><span class="line"><span class="keyword">select</span> @PID=<span class="keyword">Max</span>(员工编号) <span class="keyword">from</span> tb_Employee </span><br><span class="line"><span class="keyword">if</span>(@PID <span class="keyword">is</span> <span class="literal">null</span>) </span><br><span class="line"><span class="keyword">set</span> @PID=<span class="string">'P1001'</span> </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line"><span class="keyword">set</span> @PID=<span class="string">'P'</span>+<span class="keyword">cast</span>(<span class="keyword">cast</span>(<span class="keyword">substring</span>(@PID,<span class="number">2</span>,<span class="number">4</span>) <span class="keyword">as</span> <span class="built_in">int</span>)+<span class="number">1</span> <span class="keyword">as</span> <span class="keyword">nvarchar</span>(<span class="number">50</span>)) </span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_Employee <span class="keyword">values</span>(@PID,@PName,@PSex,@PAge,@PWage) </span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line"><span class="keyword">go</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 带输出参数 */</span></span><br><span class="line"><span class="keyword">CREATE</span> PROC PROC_EXISTS </span><br><span class="line">( </span><br><span class="line">@UserName <span class="keyword">NVARCHAR</span>(<span class="number">20</span>), </span><br><span class="line">@<span class="keyword">PassWord</span> <span class="keyword">NVARCHAR</span>(<span class="number">20</span>), </span><br><span class="line">@ReturnValue <span class="built_in">int</span> <span class="keyword">OUTPUT</span> </span><br><span class="line">) </span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">IF</span> <span class="keyword">EXISTS</span>(<span class="keyword">select</span> * <span class="keyword">from</span> tb_member <span class="keyword">where</span> userName=@UserName <span class="keyword">AND</span> <span class="keyword">passWord</span>=@<span class="keyword">PassWord</span>) </span><br><span class="line"><span class="keyword">set</span> @ReturnValue= <span class="number">100</span> </span><br><span class="line"><span class="keyword">ELSE</span> </span><br><span class="line"><span class="keyword">set</span> @ReturnValue= <span class="number">-100</span> </span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> @IsRight <span class="built_in">int</span> </span><br><span class="line">exec StuProc <span class="string">'赵雷'</span> , @IsRight <span class="keyword">output</span></span><br><span class="line"><span class="keyword">select</span> @IsRight</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Tips:</strong> 需要使用精确的时间时，使用LONG代替DATE，精确到毫秒。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/16/Druid/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/16/Druid/" itemprop="url">Druid</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-16T13:51:33+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/db/" itemprop="url" rel="index">
                    <span itemprop="name">db</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="SQL-Parser"><a href="#SQL-Parser" class="headerlink" title="SQL Parser"></a>SQL Parser</h1><h2 id="Parser"><a href="#Parser" class="headerlink" title="Parser"></a>Parser</h2><h3 id="Lexer词法分析"><a href="#Lexer词法分析" class="headerlink" title="Lexer词法分析"></a>Lexer词法分析</h3><p>Lexer中拥有词汇表，即Keywords。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Keywords keywods = Keywords.DEFAULT_KEYWORDS;</span><br></pre></td></tr></table></figure>
<p><code>DEFAULT_KEYWORDS</code>是一个Map&lt;String, Token&gt;，<code>Token</code>是词汇的枚举类，包含<code>SELECT\INSERT\FROM\WHERE</code>等。</p>
<p><code>nextToken()</code>从SQL语句解析出下一个单词。<br><code>token()</code>返回上一次解析的单词的Token类型。<br><code>stringVal()</code>获取标识符(Identifier)类型的值。</p>
<h3 id="Parser语法分析"><a href="#Parser语法分析" class="headerlink" title="Parser语法分析"></a>Parser语法分析</h3><p>在<code>SQLStatementParser</code>的<code>parseStatement</code>方法中通过调用<code>token()</code>方法，解析<code>SQLStatement</code>。如果Token类型为<code>SELECT</code>，则调用<code>parseSelect()</code>方法解析<code>SQLSelectStatement</code>。</p>
<h2 id="AST抽象语法树"><a href="#AST抽象语法树" class="headerlink" title="AST抽象语法树"></a>AST抽象语法树</h2><h3 id="节点类型"><a href="#节点类型" class="headerlink" title="节点类型"></a>节点类型</h3><ul>
<li>interface SQLObject {}</li>
<li><p>interface SQLExpr extends SQLObject {}</p>
<ul>
<li><p>interface SQLName extends SQLExpr {}</p>
<ul>
<li>class SQLIdentifierExpr implements SQLName  //如<code>ID = 3</code>的<code>ID</code></li>
<li>class SQLPropertyExpr implements SQLName  //如<code>A.ID = 3</code>的<code>A.ID</code></li>
</ul>
</li>
<li><p>class SQLBinaryOpExpr implements SQLExpr  //如<code>ID = 3</code>是一个SQLBinaryOpExpr，left是ID (SQLIdentifierExpr)，right是3 (SQLIntegerExpr)</p>
</li>
<li>class SQLIntegerExpr extends SQLNumericLiteralExpr implements SQLValuableExpr  //如<code>ID = 3</code>的<code>3</code>是一个SQLIntegerExpr</li>
<li>class SQLCharExpr extends SQLTextLiteralExpr implements SQLValuableExpr  //如<code>NAME = &#39;jobs&#39;</code>的<code>&#39;jobs&#39;</code>是一个SQLCharExpr</li>
</ul>
</li>
<li><p>interface SQLStatement extends SQLObject {}</p>
<ul>
<li>class SQLSelectStatement implements SQLStatement</li>
<li>class SQLUpdateStatement implements SQLStatement</li>
<li>class SQLDeleteStatement implements SQLStatement</li>
<li>class SQLInsertStatement implements SQLStatement</li>
</ul>
</li>
<li><p>class SQLCreateTableStatement extends SQLStatementImpl</p>
</li>
<li><p>interface SQLTableSource extends SQLObject {}</p>
<ul>
<li><p>class SQLTableSourceImpl extends SQLObjectImpl implements SQLTableSource</p>
<ul>
<li>class SQLExprTableSource extends SQLTableSourceImpl  //如<code>select * from emp where i = 3</code>，的<code>from emp</code>是一个SQLExprTableSource，其中<code>expr</code>是一个<code>name=emp</code>的SQLIdentifierExpr</li>
<li>class SQLJoinTableSource extends SQLTableSourceImpl  //如<code>select * from emp e inner join org o on e.org_id = o.id</code>，其中left <code>&#39;emp e&#39;</code> 是一个SQLExprTableSource，right <code>&#39;org o&#39;</code>也是一个SQLExprTableSource，condition <code>&#39;e.org_id = o.id&#39;</code>是一个SQLBinaryOpExpr</li>
<li>SQLSubqueryTableSource extends SQLTableSourceImpl  //如<code>select * from (select * from temp) a</code>，这里第一层<code>from(...)</code>是一个SQLSubqueryTableSource</li>
</ul>
</li>
</ul>
</li>
<li><p>class SQLSelect extends SQLObject {}</p>
</li>
<li>interface SQLSelectQuery extends SQLObject {}</li>
<li>class SQLSelectQueryBlock extends SQLObject {}</li>
<li>class SQLUnionQuery implements SQLSelectQuery</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> String dbType = JdbcConstants.MYSQL;  <span class="comment">//可以是ORACLE、POSTGRESQL、SQLSERVER、ODPS等</span></span><br><span class="line">String sql = <span class="string">"select * from t"</span>;</span><br><span class="line">List&lt;SQLStatement&gt; stmtList = SQLUtils.parseStatements(sql, dbType);  <span class="comment">//生成SQL语句</span></span><br><span class="line">SQLExpr expr = SQLUtils.toSQLExpr(<span class="string">"id=3"</span>, dbType);  <span class="comment">//生成表达式</span></span><br></pre></td></tr></table></figure>
<h2 id="Visitor"><a href="#Visitor" class="headerlink" title="Visitor"></a>Visitor</h2><ul>
<li>OutputVisitor用来把AST输出为字符串</li>
<li>WallVisitor分析SQL语意来防御SQL注入攻击</li>
<li>ParameterizedOutputVisitor用来合并未参数化的SQL进行统计</li>
<li>EvalVisitor用来对SQL表达式求值</li>
<li>ExportParameterVisitor用来提取SQL中的变量参数</li>
<li>SchemaStatVisitor用来统计SQL中使用的表、字段、过滤条件、排序表达式、分组表达式</li>
<li>SQL格式化 Druid内置了基于语义的SQL格式化功能</li>
</ul>
<h2 id="典型操作"><a href="#典型操作" class="headerlink" title="典型操作"></a>典型操作</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">"select * from user order by id"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新建 MySQL Parser</span></span><br><span class="line">SQLStatementParser parser = <span class="keyword">new</span> MySqlStatementParser(sql);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Parser解析生成AST，这里SQLStatement就是AST</span></span><br><span class="line">SQLStatement statement = parser.parseStatement();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用visitor来访问AST</span></span><br><span class="line">MySqlSchemaStatVisitor visitor = <span class="keyword">new</span> MySqlSchemaStatVisitor();</span><br><span class="line">statement.accept(visitor);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"getColumns:"</span> + visitor.getColumns());</span><br><span class="line">System.out.println(<span class="string">"getTables:"</span> + visitor.getTables());</span><br><span class="line">System.out.println(<span class="string">"getParameters:"</span> + visitor.getParameters());</span><br><span class="line">System.out.println(<span class="string">"getOrderByColumns:"</span> + visitor.getOrderByColumns());</span><br><span class="line">System.out.println(<span class="string">"getGroupByColumns:"</span> + visitor.getGroupByColumns());</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(statement <span class="keyword">instanceof</span> SQLSelectStatement)</span><br><span class="line">&#123;</span><br><span class="line">    SQLSelect select = ((SQLSelectStatement) statement).getSelect();</span><br><span class="line">    SQLSelectQuery query = select.getQuery();</span><br><span class="line">    <span class="keyword">if</span>(query <span class="keyword">instanceof</span> SQLSelectQueryBlock)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//解析Table</span></span><br><span class="line">        SQLTableSource table = ((SQLSelectQueryBlock) query).getFrom();</span><br><span class="line">        System.out.println(<span class="string">"getFrom: "</span> + table);</span><br><span class="line">        <span class="comment">//关联查询</span></span><br><span class="line">        <span class="keyword">if</span>(table <span class="keyword">instanceof</span> SQLJoinTableSource)</span><br><span class="line">        &#123;</span><br><span class="line">            SQLJoinTableSource joinTable=(SQLJoinTableSource)table;</span><br><span class="line">            String joinType=joinTable.getJoinType().toString();</span><br><span class="line">            System.out.println(<span class="string">"joinType: "</span> + joinType);  <span class="comment">//关联类型：JOIN/COMMA</span></span><br><span class="line">            System.out.println(<span class="string">"getLeft: "</span> + joinTable.getLeft());  <span class="comment">//左表</span></span><br><span class="line">            System.out.println(<span class="string">"getRight: "</span> + joinTable.getRight());  <span class="comment">//右表</span></span><br><span class="line">            SQLExpr expr = joinTable.getCondition();  <span class="comment">//关联条件</span></span><br><span class="line">            System.out.println(<span class="string">"getCondition: "</span> + expr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">""</span>);</span><br><span class="line">        <span class="comment">//查询列</span></span><br><span class="line">        List&lt;SQLSelectItem&gt; mysqlSelectList = ((SQLSelectQueryBlock) query).getSelectList();</span><br><span class="line">        System.out.println(<span class="string">"getSelectList: "</span> + mysqlSelectList);</span><br><span class="line">        <span class="keyword">for</span>(SQLSelectItem sqlSelectItem : mysqlSelectList)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//select *</span></span><br><span class="line">            <span class="keyword">if</span> (sqlSelectItem.getExpr() <span class="keyword">instanceof</span> SQLAllColumnExpr)</span><br><span class="line">            &#123;</span><br><span class="line">                System.out.println(<span class="string">"getExpr: "</span> + sqlSelectItem.getExpr());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//聚合函数</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(sqlSelectItem.getExpr() <span class="keyword">instanceof</span> SQLAggregateExpr)</span><br><span class="line">            &#123;</span><br><span class="line">                System.out.println(<span class="string">"getMethodName: "</span> + ((SQLAggregateExpr) sqlSelectItem.getExpr()).getMethodName());  <span class="comment">//函数名称</span></span><br><span class="line">                System.out.println(<span class="string">"getArguments: "</span> + ((SQLAggregateExpr) sqlSelectItem.getExpr()).getArguments());  <span class="comment">//参数列表</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (sqlSelectItem.getExpr() <span class="keyword">instanceof</span> SQLPropertyExpr)</span><br><span class="line">            &#123;</span><br><span class="line">                System.out.println(<span class="string">"getExpr: "</span> + sqlSelectItem.getExpr());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                System.out.println(<span class="string">"item: "</span> + sqlSelectItem);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">""</span>);</span><br><span class="line">        <span class="comment">//查询条件</span></span><br><span class="line">        SQLExpr expr = ((SQLSelectQueryBlock) query).getWhere();</span><br><span class="line">        System.out.println(<span class="string">"getWhere: "</span> + expr);</span><br><span class="line">        <span class="keyword">if</span> (expr <span class="keyword">instanceof</span> SQLBinaryOpExpr)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//表达式</span></span><br><span class="line">            SQLBinaryOpExpr bexpr = (SQLBinaryOpExpr)expr;</span><br><span class="line">            System.out.println(<span class="string">"getLeft: "</span> + bexpr.getLeft());</span><br><span class="line">            System.out.println(<span class="string">"getRight: "</span> + bexpr.getRight());</span><br><span class="line">            System.out.println(<span class="string">"getOperator: "</span> + bexpr.getOperator());  <span class="comment">//BooleanAnd\BooleanOr</span></span><br><span class="line">            <span class="keyword">if</span> (bexpr.getLeft() <span class="keyword">instanceof</span> SQLBinaryOpExpr)</span><br><span class="line">            &#123;</span><br><span class="line">                SQLBinaryOpExpr bexprL = (SQLBinaryOpExpr)bexpr.getLeft();</span><br><span class="line">                System.out.println(<span class="string">"LgetLeft: "</span> + bexprL.getLeft());</span><br><span class="line">                <span class="comment">//字符串值</span></span><br><span class="line">                <span class="keyword">if</span> (bexprL.getRight() <span class="keyword">instanceof</span> SQLCharExpr)</span><br><span class="line">                &#123;</span><br><span class="line">                    System.out.println(<span class="string">"LgetRight: "</span> + ((SQLCharExpr)bexprL.getRight()).toString());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//Equality</span></span><br><span class="line">                <span class="keyword">if</span> (SQLBinaryOperator.Equality == bexprL.getOperator())</span><br><span class="line">                &#123;</span><br><span class="line">                    System.out.println(<span class="string">"LgetOperator: ="</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (bexpr.getRight() <span class="keyword">instanceof</span> SQLBinaryOpExpr)</span><br><span class="line">            &#123;</span><br><span class="line">                SQLBinaryOpExpr bexprR = (SQLBinaryOpExpr)bexpr.getRight();</span><br><span class="line">                System.out.println(<span class="string">"RgetLeft: "</span> + bexprR.getLeft());</span><br><span class="line">                <span class="comment">//数字值</span></span><br><span class="line">                <span class="keyword">if</span> (bexprR.getRight() <span class="keyword">instanceof</span> SQLIntegerExpr)</span><br><span class="line">                &#123;</span><br><span class="line">                    System.out.println(<span class="string">"RgetRight: "</span> + ((SQLIntegerExpr)bexprR.getRight()).getNumber().longValue());</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">"RgetOperator: "</span> + bexprR.getOperator());  <span class="comment">//GreaterThan</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(expr <span class="keyword">instanceof</span> SQLInListExpr)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//IN子句</span></span><br><span class="line">            SQLInListExpr inexpr = (SQLInListExpr)expr;</span><br><span class="line">            SQLExpr exprL =  inexpr.getExpr();</span><br><span class="line">            System.out.println(<span class="string">"in getExpr: "</span> + exprL);</span><br><span class="line">            System.out.println(<span class="string">"toMySqlString: "</span> + SQLUtils.toMySqlString(inexpr));  <span class="comment">//将IN转换成key in (values)</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">""</span>);</span><br><span class="line">        <span class="comment">//排序</span></span><br><span class="line">        SQLOrderBy orderby = ((SQLSelectQueryBlock) query).getOrderBy();</span><br><span class="line">        <span class="keyword">if</span> (orderby != <span class="keyword">null</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;SQLSelectOrderByItem&gt; orderbyItems = orderby.getItems();</span><br><span class="line">            <span class="keyword">for</span> (SQLSelectOrderByItem orderitem : orderbyItems)</span><br><span class="line">            &#123;</span><br><span class="line">                System.out.println(<span class="string">"getExpr: "</span> + orderitem.getExpr());</span><br><span class="line">                <span class="keyword">if</span> (SQLOrderingSpecification.ASC==orderitem.getType() || SQLOrderingSpecification.DESC==orderitem.getType())</span><br><span class="line">                &#123;</span><br><span class="line">                    System.out.println(<span class="string">"getType: "</span> + orderitem.getType());  <span class="comment">//ASC\DESC</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">""</span>);</span><br><span class="line">        <span class="comment">//分页</span></span><br><span class="line">        SQLLimit limit = ((SQLSelectQueryBlock) query).getLimit();</span><br><span class="line">        <span class="keyword">if</span> (limit != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">"getOffset: "</span> + limit.getOffset());</span><br><span class="line">            System.out.println(<span class="string">"getRowCount: "</span> + limit.getRowCount());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建表语句中查找主键和自增字段</span></span><br><span class="line"><span class="keyword">if</span>(statement <span class="keyword">instanceof</span> MySqlCreateTableStatement)</span><br><span class="line">&#123;</span><br><span class="line">    MySqlCreateTableStatement createTableStatement = (MySqlCreateTableStatement)statement;</span><br><span class="line">    List&lt;SQLTableElement&gt; tableElementList = createTableStatement.getTableElementList();</span><br><span class="line">    <span class="comment">// 找出主键</span></span><br><span class="line">    <span class="keyword">for</span> (SQLTableElement element : tableElementList) &#123;</span><br><span class="line">        <span class="comment">// 单独定义的主键，PRIMARY KEY (name，id)</span></span><br><span class="line">        <span class="keyword">if</span> (element <span class="keyword">instanceof</span> MySqlPrimaryKey) &#123;</span><br><span class="line">            List&lt;SQLExpr&gt; columns = ((MySqlPrimaryKey) element).getColumns();</span><br><span class="line">            System.out.println(<span class="string">"PrimaryKey: "</span> + columns.get(<span class="number">0</span>).toString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 字段定义后面 id int primary key,</span></span><br><span class="line">        <span class="keyword">if</span> (element <span class="keyword">instanceof</span> SQLColumnDefinition) &#123;</span><br><span class="line">            SQLColumnDefinition columnDefinition = (SQLColumnDefinition) element;</span><br><span class="line">            <span class="comment">// 自增长列名称</span></span><br><span class="line">            String columnName = columnDefinition.getName().toString();</span><br><span class="line">            <span class="comment">//判断id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY</span></span><br><span class="line">            List&lt;SQLColumnConstraint&gt; constraints = columnDefinition.getConstraints();</span><br><span class="line">            <span class="keyword">for</span> (SQLColumnConstraint constraintTmp : constraints) &#123;</span><br><span class="line">                <span class="keyword">if</span> (constraintTmp <span class="keyword">instanceof</span> SQLColumnPrimaryKey) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"Constraint PrimaryKey: "</span> + columnName);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 自增字段</span></span><br><span class="line">            <span class="keyword">if</span> (columnDefinition.isAutoIncrement())</span><br><span class="line">            &#123;</span><br><span class="line">                System.out.println(<span class="string">"AutoIncrement: "</span> + columnName);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 字段类型</span></span><br><span class="line">            SQLDataType sqlDataType = columnDefinition.getDataType();</span><br><span class="line">            <span class="keyword">if</span> (sqlDataType != <span class="keyword">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"DataType: "</span> + sqlDataType.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/alibaba/druid/wiki/SQL-Parser" target="_blank" rel="noopener">官方文档</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/08/MySQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/08/MySQL/" itemprop="url">MySQL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-08T11:58:45+08:00">
                2018-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/db/" itemprop="url" rel="index">
                    <span itemprop="name">db</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h1><p>schema：数据库，例如查询所有数据库名称和默认编码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select schema_name, default_character_set_name from information_schema.schemata;</span><br><span class="line"></span><br><span class="line">+<span class="comment">--------------------+----------------------------+</span></span><br><span class="line">| schema_name        | default_character_set_name |</span><br><span class="line">+<span class="comment">--------------------+----------------------------+</span></span><br><span class="line">| information_schema | utf8                       |</span><br><span class="line">| db_6922_0000       | latin1                     |</span><br><span class="line">| mysql              | latin1                     |</span><br><span class="line">| performance_schema | utf8                       |</span><br><span class="line">| sys                | utf8                       |</span><br><span class="line">+<span class="comment">--------------------+----------------------------+</span></span><br><span class="line">12 rows in <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure>
<h1 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ... */</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>/*! ... */</code> 仅在MySQL中执行。如：<code>/*! select * from user*/;</code><br><code>/*!50001 select * from user*/;</code> 仅在5.00.01以上的MySQL版本中执行。</p>
</blockquote>
<h1 id="information-schema数据库"><a href="#information-schema数据库" class="headerlink" title="information_schema数据库"></a>information_schema数据库</h1><h2 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h2><ul>
<li>CHARACTER_SETS: 字符集</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*查看支持的字符集*/</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> information_schema.CHARACTER_SETS;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> <span class="keyword">where</span> <span class="keyword">charset</span>=<span class="string">'utf8'</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> <span class="keyword">like</span> <span class="string">'utf8%'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>COLLATIONS: 字符集排序规则</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*查看支持的字符序*/</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">COLLATION</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">COLLATION</span> <span class="keyword">where</span> <span class="keyword">charset</span>=<span class="string">'utf8'</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> information_schema.COLLATIONS <span class="keyword">where</span> CHARACTER_SET_NAME=<span class="string">'utf8'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="设置级别"><a href="#设置级别" class="headerlink" title="设置级别"></a>设置级别</h3><h4 id="server"><a href="#server" class="headerlink" title="server"></a>server</h4><p>创建数据库时未指定字符集，字符序，默认使用server字符集，字符序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*查看server字符集，字符序*/</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'character_set_server'</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'collation_server'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>启动服务时指定：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqld --character-set-server=latin1 \</span><br><span class="line">       --collation-server=latin1_swedish_ci</span><br></pre></td></tr></table></figure>
<ul>
<li>配置文件指定，<code>/etc/my.cnf</code>：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_unicode_ci</span><br><span class="line">#指定客户端连接使用的字符集，相当于运行时执行：SET NAMES &apos;utf8&apos;;</span><br><span class="line">#SET character_set_client = utf8; SET character_set_results = utf8; SET character_set_connection = utf8;</span><br><span class="line">init-connect=&apos;SET NAMES utf8&apos;</span><br></pre></td></tr></table></figure>
<ul>
<li>运行时修改</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> character_set_server=utf8;  <span class="comment">/*重启后生效*/</span></span><br></pre></td></tr></table></figure>
<h4 id="database"><a href="#database" class="headerlink" title="database"></a>database</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*查看数据库字符集，字符序*/</span></span><br><span class="line"><span class="keyword">select</span> @@character_set_database, @@collation_database;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> information_schema.SCHEMATA <span class="keyword">where</span> SCHEMA_NAME=<span class="string">'xxx'</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> xxx;</span><br><span class="line"><span class="comment">/*创建数据库时设置字符集*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> test_schema <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8;</span><br><span class="line"><span class="comment">/*修改数据库字符集*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> test_schema <span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span>=gb2312;</span><br></pre></td></tr></table></figure>
<h4 id="table"><a href="#table" class="headerlink" title="table"></a>table</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*创建表时指定字符集*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">PersonID <span class="built_in">int</span>,</span><br><span class="line">PName <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">) <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span>=utf8;</span><br><span class="line"><span class="comment">/*修改表字符集*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span>=utf8;</span><br><span class="line"><span class="comment">/*查看表字符集*/</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> <span class="keyword">STATUS</span> <span class="keyword">FROM</span> test_schema;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> information_schema.TABLES <span class="keyword">where</span> TABLE_SCHEMA=<span class="string">'test_schema'</span> <span class="keyword">and</span> TABLE_NAME=<span class="string">'Persons'</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons;</span><br></pre></td></tr></table></figure>
<h4 id="column"><a href="#column" class="headerlink" title="column"></a>column</h4><p>类型为CHAR, VARCHAR, TEXT的列，可以指定字符集，字符序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*新增列时指定字符集*/</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> Addr <span class="built_in">VARCHAR</span>(<span class="number">25</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8;</span><br><span class="line"><span class="comment">/*查看列字符集*/</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> information_schema.COLUMNS <span class="keyword">where</span> TABLE_SCHEMA=<span class="string">'test_schema'</span> <span class="keyword">and</span> TABLE_NAME=<span class="string">'Persons'</span>;</span><br></pre></td></tr></table></figure>
<p>参考链接：<a href="https://dev.mysql.com/doc/refman/5.7/en/charset.html" target="_blank" rel="noopener">Character Sets, Collations, Unicode</a></p>
<h2 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h2><blockquote>
<ul>
<li>SCHEMA_PRIVILEGES 数据库相关权限，mysql.db</li>
<li>TABLE_PRIVILEGES 表相关权限，mysql.tables_priv</li>
<li>COLUMN_PRIVILEGES 表授权的用户对象</li>
<li>USER_PRIVILEGES 用户相关权限，mysql.user<ul>
<li>Select_priv</li>
<li>Insert_priv</li>
<li>Update_priv</li>
<li>Delete_priv</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 新增用户，限制登录ip为10.155.123.%，%为通配符 */</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mysql.user(Host,<span class="keyword">User</span>,<span class="keyword">Password</span>) <span class="keyword">VALUES</span>(<span class="string">"10.155.123.%"</span>,<span class="string">"kaka"</span>,<span class="keyword">PASSWORD</span>(<span class="string">"kaka123"</span>));</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;  <span class="comment">/* 刷新系统权限相关表 */</span></span><br><span class="line">service mysqld restart  <span class="comment">/* 重启生效 */</span></span><br></pre></td></tr></table></figure>
<h3 id="权限分配"><a href="#权限分配" class="headerlink" title="权限分配"></a>权限分配</h3><p><code>GRANT 权限 ON 数据库.* TO 用户名@&#39;登录主机&#39; IDENTIFIED BY &#39;密码&#39;</code></p>
<ul>
<li>权限：<code>ALL,ALTER,CREATE,DROP,SELECT,UPDATE,DELETE</code></li>
<li>数据库：<code>*.*  表示所有库的所有表</code></li>
<li>用户名：<code>MySQL的账户名</code></li>
<li>登陆主机：<code>&#39;%&#39;表示所有ip</code></li>
<li>密码：<code>MySQL的账户名对应的登陆密码</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> test.user <span class="keyword">TO</span> kaka@<span class="string">'10.155.123.55'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">Grants</span> <span class="keyword">for</span> <span class="string">'kaka'</span>@<span class="string">'10.155.123.55'</span>;</span><br></pre></td></tr></table></figure>
<h2 id="实体对象"><a href="#实体对象" class="headerlink" title="实体对象"></a>实体对象</h2><blockquote>
<ul>
<li>COLUMNS 表字段</li>
<li>SCHEMATA 所有数据库及默认字符集</li>
</ul>
</blockquote>
<h1 id="MySQL协议"><a href="#MySQL协议" class="headerlink" title="MySQL协议"></a>MySQL协议</h1><h2 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h2><h3 id="Integers"><a href="#Integers" class="headerlink" title="Integers"></a>Integers</h3><h4 id="Fixed-length-integers"><a href="#Fixed-length-integers" class="headerlink" title="Fixed-length integers"></a>Fixed-length integers</h4><p>定长，例 int<3><br><code>01 00 00</code></3></p>
<h4 id="Length-encoded-integers"><a href="#Length-encoded-integers" class="headerlink" title="Length-encoded integers"></a>Length-encoded integers</h4><p>用第一个字节代表存储长度。例：</p>
<p><code>fa</code>       – 250<br><code>fc fb 00</code> – 251</p>
<ul>
<li>&lt;0xfb 1字节</li>
<li>0xfc 2字节</li>
<li>0xfd 3字节</li>
<li>0xfe 8字节</li>
</ul>
<h3 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h3><h4 id="FixedLengthString"><a href="#FixedLengthString" class="headerlink" title="FixedLengthString"></a>FixedLengthString</h4><p>定长，例 <code>string&lt;fix&gt;</code></p>
<h4 id="NulTerminatedString"><a href="#NulTerminatedString" class="headerlink" title="NulTerminatedString"></a>NulTerminatedString</h4><p><code>string&lt;NUL&gt;</code> ，以 <code>00</code> 结尾。</p>
<h4 id="VariableLengthString"><a href="#VariableLengthString" class="headerlink" title="VariableLengthString"></a>VariableLengthString</h4><p><code>string&lt;var&gt;</code></p>
<h4 id="LengthEncodedString"><a href="#LengthEncodedString" class="headerlink" title="LengthEncodedString"></a>LengthEncodedString</h4><p><code>string&lt;lenenc&gt;</code></p>
<h4 id="RestOfPacketString"><a href="#RestOfPacketString" class="headerlink" title="RestOfPacketString"></a>RestOfPacketString</h4><p><code>string&lt;EOF&gt;</code></p>
<h2 id="Packets"><a href="#Packets" class="headerlink" title="Packets"></a>Packets</h2><p>MySQL协议包被切分为最多2^24-1字节，每个分片携带包头。</p>
<h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3><table>
<thead>
<tr>
<th>Type</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>int<3></3></td>
<td>payload_length</td>
<td>payload长度</td>
</tr>
<tr>
<td>int<1></1></td>
<td>sequence_id</td>
<td>报文序列号</td>
</tr>
<tr>
<td>string<var></var></td>
<td>payload</td>
<td>payload</td>
</tr>
</tbody>
</table>
<p>例，<code>COM_QUIT</code>：</p>
<p><code>01 00 00 00 01</code></p>
<ul>
<li>length: 0x01</li>
<li>sequence_id: 0x00</li>
<li>payload: 0x01</li>
</ul>
<p><code>COM_QUERY</code>：</p>
<p><code>13 00 00 00 03 53 ...</code></p>
<ul>
<li>length: 0x13</li>
<li>sequence_id: 0x00</li>
<li>命令类型：0x03</li>
<li>命令：0x53 …</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/08/UML/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/08/UML/" itemprop="url">UML</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-08T11:56:17+08:00">
                2018-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/design/" itemprop="url" rel="index">
                    <span itemprop="name">design</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h1><ul>
<li>类名</li>
<li>属性field</li>
<li>方法method</li>
</ul>
<h2 id="可见性"><a href="#可见性" class="headerlink" title="可见性"></a>可见性</h2><blockquote>
<p>public +<br>private -<br>protected #</p>
</blockquote>
<h2 id="完整表示"><a href="#完整表示" class="headerlink" title="完整表示"></a>完整表示</h2><p>可见性  名称 ：类型 [ = 缺省值]<br>可见性  名称(参数列表) [ ： 返回类型]</p>
<h2 id="类之间的关系"><a href="#类之间的关系" class="headerlink" title="类之间的关系"></a>类之间的关系</h2><h3 id="单向关联"><a href="#单向关联" class="headerlink" title="单向关联"></a>单向关联</h3><p>箭头 -&gt;</p>
<h3 id="双向关联"><a href="#双向关联" class="headerlink" title="双向关联"></a>双向关联</h3><p>直线 -</p>
<h3 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h3><p>空心菱形箭头 &lt;&gt;-&gt;</p>
<h3 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h3><p>实心菱形箭头 &lt;*&gt;-&gt;</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p>虚线箭头 —&gt;</p>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>空心三角 -|&gt;</p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>虚线空心三角 —|&gt;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/08/AIO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/08/AIO/" itemprop="url">AIO</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-08T11:54:02+08:00">
                2018-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>AIO需要操作系统支持.</p>
<h1 id="核心类"><a href="#核心类" class="headerlink" title="核心类"></a>核心类</h1><ul>
<li><p>AsynchronousChannelGroup</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用线程池初始化AsynchronousChannelGroup</span></span><br><span class="line">ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">80</span>);  <span class="comment">//处理IO事件和触发CompletionHandler回调接口</span></span><br><span class="line">AsynchronousChannelGroup channelGroup = AsynchronousChannelGroup.withThreadPool(executorService);</span><br></pre></td></tr></table></figure>
</li>
<li><p>AsynchronousServerSocketChannel</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用group初始化server socket</span></span><br><span class="line">AsynchronousServerSocketChannel serverChannel = AsynchronousServerSocketChannel.open(channelGroup);</span><br><span class="line">setOption(SocketOption&lt;T&gt; name, T value)  <span class="comment">//配置Socket参数</span></span><br><span class="line">serverChannel.bind(<span class="keyword">new</span> InetSocketAddress(ip, port), <span class="number">100</span>);  <span class="comment">//backlog参数指定队列中挂起的连接的最大个数</span></span><br><span class="line"></span><br><span class="line"><span class="function">Future&lt;AsynchronousSocketChannel&gt; <span class="title">accept</span><span class="params">()</span>  <span class="comment">//通过返回Future的get方法接收客户端请求</span></span></span><br><span class="line"><span class="function"><span class="comment">//示例代码</span></span></span><br><span class="line"><span class="function"><span class="title">while</span> <span class="params">(<span class="keyword">true</span>)</span></span>&#123;</span><br><span class="line">    Future&lt;AsynchronousSocketChannel&gt; future = serverSocketChannel.accept();</span><br><span class="line">    AsynchronousSocketChannel socketChannel = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        socketChannel = future.get();</span><br><span class="line">        socketChannel.write(ByteBuffer.wrap(<span class="string">"ssss"</span>.getBytes(<span class="string">"UTF-8"</span>)));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;A&gt; <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(A attachment ,CompletionHandler&lt;AsynchronousSocketChannel,? <span class="keyword">super</span> A&gt; handler)</span>  <span class="comment">//通过回调方法接收客户端请求</span></span></span><br><span class="line"><span class="function"><span class="comment">//CompletionHandler定义两个方法：</span></span></span><br><span class="line"><span class="function"><span class="title">completed</span><span class="params">(V result , A attachment)</span>  <span class="comment">//参数：IO操作返回的对象AsynchronousSocketChannel， 发起IO操作时传入的附加参数</span></span></span><br><span class="line"><span class="function"><span class="title">faild</span><span class="params">(Throwable exc, A attachment)</span>  <span class="comment">//参数：IO操作失败引发的异常或错误， 发起IO操作时传入的附加参数</span></span></span><br><span class="line"><span class="function"><span class="comment">//示例代码</span></span></span><br><span class="line"><span class="function">server.<span class="title">accept</span><span class="params">(<span class="keyword">null</span>, new CompletionHandler&lt;AsynchronousSocketChannel, Object&gt;()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">final</span> ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completed</span><span class="params">(AsynchronousSocketChannel result, Object attachment)</span> </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">"waiting...."</span>);  </span><br><span class="line">        buffer.clear();  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="comment">//把socket中的数据读取到buffer中  </span></span><br><span class="line">            result.read(buffer).get();  </span><br><span class="line">            buffer.flip();  </span><br><span class="line">            System.out.println(<span class="string">"Echo "</span> + <span class="keyword">new</span> String(buffer.array()).trim() + <span class="string">" to "</span> + result);  </span><br><span class="line">             </span><br><span class="line">            <span class="comment">//把收到的直接返回给客户端  </span></span><br><span class="line">            result.write(buffer);  </span><br><span class="line">            buffer.flip();  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                <span class="comment">//关闭处理完的socket，并重新调用accept等待新的连接  </span></span><br><span class="line">                result.close();  </span><br><span class="line">                server.accept(<span class="keyword">null</span>, <span class="keyword">this</span>);  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">                e.printStackTrace();  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">(Throwable exc, Object attachment)</span> </span>&#123;  </span><br><span class="line">        System.out.print(<span class="string">"Server failed...."</span> + exc.getCause());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>AsynchronousSocketChannel</p>
<ul>
<li>connect()  用于连接到指定IP/端口的服务器</li>
<li>read()</li>
<li>write()</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/08/curl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/08/curl/" itemprop="url">curl</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-08T11:49:42+08:00">
                2018-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h1><blockquote>
<ul>
<li>-i –include 输出协议头信息</li>
<li>-k –insecure 访问SSL网站不校验证书</li>
<li>-H –header LINE 自定义header</li>
<li>-X –request COMMAND 请求类型POST/GET/PUT/DELETE</li>
<li>-d –data DATA HTTP POST body</li>
<li>-v –verbose 显示冗余信息</li>
</ul>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/08/grep/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/08/grep/" itemprop="url">grep</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-08T11:48:21+08:00">
                2018-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/os/" itemprop="url" rel="index">
                    <span itemprop="name">os</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在每个FILE或标准输入中查找PATTERN.</p>
<h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -i <span class="string">'hello world'</span> first.java second.properties</span><br></pre></td></tr></table></figure>
<h1 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h1><blockquote>
<ul>
<li>-i –ignore-case 忽略大小写</li>
<li>-v –invert-match 查找不匹配的行</li>
</ul>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/08/MongoDB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/08/MongoDB/" itemprop="url">MongoDB</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-08T11:46:28+08:00">
                2018-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/db/" itemprop="url" rel="index">
                    <span itemprop="name">db</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="NoSQL数据库分类"><a href="#NoSQL数据库分类" class="headerlink" title="NoSQL数据库分类"></a>NoSQL数据库分类</h1><table>
<thead>
<tr>
<th>类型</th>
<th>部分代表</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr>
<td>列存储</td>
<td>Hbase, Cassandra, Hypertable</td>
<td>顾名思义，是按列存储数据的。最大的特点是方便存储结构化和半结构化数据，方便做数据压缩，对针对某一列或者某几列的查询有非常大的IO优势。</td>
</tr>
<tr>
<td>文档存储</td>
<td>MongoDB, CouchDB</td>
<td>文档存储一般用类似json的格式存储，存储的内容是文档型的。这样也就有有机会对某些字段建立索引，实现关系数据库的某些功能。</td>
</tr>
<tr>
<td>key-value存储</td>
<td>Tokyo Cabinet / Tyrant, Berkeley DB, MemcacheDB, Redis</td>
<td>可以通过key快速查询到其value。一般来说，存储不管value的格式，照单全收。（Redis包含了其他功能）</td>
</tr>
<tr>
<td>图存储</td>
<td>Neo4J, FlockDB</td>
<td>图形关系的最佳存储。使用传统关系数据库来解决的话性能低下，而且设计使用不方便。</td>
</tr>
<tr>
<td>对象存储</td>
<td>db4o, Versant</td>
<td>通过类似面向对象语言的语法操作数据库，通过对象的方式存取数据。</td>
</tr>
<tr>
<td>xml数据库</td>
<td>Berkeley DB XML, BaseX</td>
<td>高效的存储XML数据，并支持XML的内部查询语法，比如XQuery,Xpath。</td>
</tr>
</tbody>
</table>
<h1 id="MongoDB常用命令"><a href="#MongoDB常用命令" class="headerlink" title="MongoDB常用命令"></a>MongoDB常用命令</h1><p>启动服务：<code>./mongod</code><br>管理：<code>./mongo</code><br>显示所有数据库：<code>show dbs</code><br>显示当前数据库：<code>db</code><br>连接到数据库：<code>use local</code><br>插入数据：<code>db.runoob.insert({x:10})</code><br>查找数据：<code>db.runoob.find()</code></p>
<h1 id="使用Node-js连接MongoDB"><a href="#使用Node-js连接MongoDB" class="headerlink" title="使用Node.js连接MongoDB"></a>使用Node.js连接MongoDB</h1><p><a href="http://mongodb.github.io/node-mongodb-native/3.1/quick-start/quick-start/" target="_blank" rel="noopener">Quick Start</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/08/Java单元测试/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/08/Java单元测试/" itemprop="url">Java单元测试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-08T11:45:00+08:00">
                2018-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="JUnit-4"><a href="#JUnit-4" class="headerlink" title="JUnit 4"></a>JUnit 4</h1><h2 id="添加Maven依赖到test-scope"><a href="#添加Maven依赖到test-scope" class="headerlink" title="添加Maven依赖到test scope"></a>添加Maven依赖到test scope</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被测试类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">evaluate</span><span class="params">(String expression)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (String summand: expression.split(<span class="string">"\\+"</span>))</span><br><span class="line">      sum += Integer.valueOf(summand);</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertEquals;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorTest</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Test</span>  <span class="comment">//添加注解</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">evaluatesExpression</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Calculator calculator = <span class="keyword">new</span> Calculator();</span><br><span class="line">    <span class="keyword">int</span> sum = calculator.evaluate(<span class="string">"1+2+3"</span>);</span><br><span class="line">    assertEquals(<span class="number">6</span>, sum);  <span class="comment">//断言</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h2><p>参数列表（failure message, expected value, actual value）</p>
<ul>
<li>assertArrayEquals 数组相等</li>
<li>assertEquals Object相等</li>
<li>assertTrue 值为true</li>
<li>assertFalse 值为false</li>
<li>assertNull 值为null</li>
<li>assertNotNull 不为null</li>
<li>assertSame Object是同一个对象</li>
<li>assertNotSame Object不是同一个对象</li>
<li>assertThat 条件判断</li>
</ul>
<blockquote>
<ul>
<li>containsString 包含字符串</li>
<li>both().and() 条件与</li>
<li>either().or() 条件或</li>
<li>hasItems 包含项</li>
<li>everyItem 每一项都</li>
<li>equalTo 相等</li>
<li>startsWith 以…开头</li>
<li>allOf 条件全部</li>
<li>not 条件非</li>
<li>anyOf 条件或</li>
<li>sameInstance 相同实例</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.hamcrest.core.CombinableMatcher;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.allOf;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.anyOf;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.both;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.containsString;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.equalTo;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.everyItem;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.hasItems;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.not;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.sameInstance;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.startsWith;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertArrayEquals;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertEquals;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertFalse;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertNotNull;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertNotSame;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertNull;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertSame;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertThat;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertTrue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AssertTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertArrayEquals</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] expected = <span class="string">"trial"</span>.getBytes();</span><br><span class="line">        <span class="keyword">byte</span>[] actual = <span class="string">"trial"</span>.getBytes();</span><br><span class="line">        assertArrayEquals(<span class="string">"failure - byte arrays not same"</span>, expected, actual);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertEquals</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertEquals(<span class="string">"failure - strings are not equal"</span>, <span class="string">"text"</span>, <span class="string">"text"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertTrue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertTrue(<span class="string">"failure - should be true"</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertFalse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertFalse(<span class="string">"failure - should be false"</span>, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertNull</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertNull(<span class="string">"should be null"</span>, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertNotNull</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertNotNull(<span class="string">"should not be null"</span>, <span class="keyword">new</span> Object());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertSame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Integer aNumber = Integer.valueOf(<span class="number">768</span>);</span><br><span class="line">        assertSame(<span class="string">"should be same"</span>, aNumber, aNumber);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertNotSame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertNotSame(<span class="string">"should not be same Object"</span>, <span class="keyword">new</span> Object(), <span class="keyword">new</span> Object());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// JUnit Matchers assertThat</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertThatBothContainsString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertThat(<span class="string">"albumen"</span>, both(containsString(<span class="string">"a"</span>)).and(containsString(<span class="string">"b"</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertThatHasItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertThat(Arrays.asList(<span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>), hasItems(<span class="string">"one"</span>, <span class="string">"three"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertThatEveryItemContainsString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertThat(Arrays.asList(<span class="keyword">new</span> String[] &#123; <span class="string">"fun"</span>, <span class="string">"ban"</span>, <span class="string">"net"</span> &#125;), everyItem(containsString(<span class="string">"n"</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Core Hamcrest Matchers with assertThat</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssertThatHamcrestCoreMatchers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        assertThat(<span class="string">"good"</span>, allOf(equalTo(<span class="string">"good"</span>), startsWith(<span class="string">"good"</span>)));</span><br><span class="line">        assertThat(<span class="string">"good"</span>, not(allOf(equalTo(<span class="string">"bad"</span>), equalTo(<span class="string">"good"</span>))));</span><br><span class="line">        assertThat(<span class="string">"good"</span>, anyOf(equalTo(<span class="string">"bad"</span>), equalTo(<span class="string">"good"</span>)));</span><br><span class="line">        assertThat(<span class="number">7</span>, not(CombinableMatcher.&lt;Integer&gt; either(equalTo(<span class="number">3</span>)).or(equalTo(<span class="number">4</span>))));</span><br><span class="line">        assertThat(<span class="keyword">new</span> Object(), not(sameInstance(<span class="keyword">new</span> Object())));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><h3 id="注解属性"><a href="#注解属性" class="headerlink" title="注解属性"></a>注解属性</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>(expected = IndexOutOfBoundsException.class) </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">empty</span><span class="params">()</span> </span>&#123; </span><br><span class="line">     <span class="keyword">new</span> ArrayList&lt;Object&gt;().get(<span class="number">0</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Try-Catch"><a href="#Try-Catch" class="headerlink" title="Try/Catch"></a>Try/Catch</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.is;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertThat;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.fail;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testExceptionMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> ArrayList&lt;Object&gt;().get(<span class="number">0</span>);</span><br><span class="line">        fail(<span class="string">"Expected an IndexOutOfBoundsException to be thrown"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException anIndexOutOfBoundsException) &#123;</span><br><span class="line">        assertThat(anIndexOutOfBoundsException.getMessage(), is(<span class="string">"Index: 0, Size: 0"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ExpectedException-Rule"><a href="#ExpectedException-Rule" class="headerlink" title="ExpectedException Rule"></a>ExpectedException Rule</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Rule;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.rules.ExpectedException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Rule</span></span><br><span class="line"><span class="keyword">public</span> ExpectedException thrown = ExpectedException.none();</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shouldTestExceptionMessage</span><span class="params">()</span> <span class="keyword">throws</span> IndexOutOfBoundsException </span>&#123;</span><br><span class="line">    List&lt;Object&gt; list = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line"></span><br><span class="line">    thrown.expect(IndexOutOfBoundsException.class);</span><br><span class="line">    thrown.expectMessage(<span class="string">"Index: 0, Size: 0"</span>);</span><br><span class="line">    <span class="comment">//thrown.expectMessage(CoreMatchers.containsString("Size: 0"));</span></span><br><span class="line">    <span class="comment">//thrown.expectMessage(startsWith("some Message"));</span></span><br><span class="line">    <span class="comment">//thrown.expect(hasProperty("response", hasProperty("status", is(404))));</span></span><br><span class="line">    list.get(<span class="number">0</span>); <span class="comment">// execution will never get past this line</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="忽略"><a href="#忽略" class="headerlink" title="忽略"></a>忽略</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Ignore</span>(<span class="string">"Test is ignored as a demonstration"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="预置-后置"><a href="#预置-后置" class="headerlink" title="预置/后置"></a>预置/后置</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.AfterClass;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.BeforeClass;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FSTPropertiesUtilsTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeClass</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setUpClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"@BeforeClass setUpClass"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterClass</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tearDownClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"@AfterClass tearDownClass"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"@Before setUp"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tearDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"@After tearDown"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"@Test test1()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"@Test test2()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="JMockit"><a href="#JMockit" class="headerlink" title="JMockit"></a>JMockit</h1><h2 id="添加Maven依赖到test-scope-1"><a href="#添加Maven依赖到test-scope-1" class="headerlink" title="添加Maven依赖到test scope"></a>添加Maven依赖到test scope</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jmockit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jmockit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/08/Java读取properties配置文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/08/Java读取properties配置文件/" itemprop="url">Java读取properties配置文件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-08T11:43:31+08:00">
                2018-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="读取类路径下的配置文件"><a href="#读取类路径下的配置文件" class="headerlink" title="读取类路径下的配置文件"></a>读取类路径下的配置文件</h1><p>配置文件路径：<code>src\main\resources\config\application.properties</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PATH = <span class="string">"config/application.properties"</span>;</span><br><span class="line">InputStream in = PropertiesUtil.class.getClassLoader().getResourceAsStream(PATH);</span><br><span class="line">properties.load(in);</span><br></pre></td></tr></table></figure>
<h1 id="读取任意路径下的配置文件"><a href="#读取任意路径下的配置文件" class="headerlink" title="读取任意路径下的配置文件"></a>读取任意路径下的配置文件</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">"F:/config.properties"</span>));</span><br><span class="line">properties.load(bufferedReader);</span><br></pre></td></tr></table></figure>
<h1 id="国际化"><a href="#国际化" class="headerlink" title="国际化"></a>国际化</h1><h2 id="定义语言资源文件："><a href="#定义语言资源文件：" class="headerlink" title="定义语言资源文件："></a>定义语言资源文件：</h2><p>资源路径：<code>src\main\resources\localize\info.properties</code></p>
<ul>
<li>info_zh_CN.properties</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">username=\u7528\u6237\u540d</span><br><span class="line">passwd=\u5BC6\u7801</span><br><span class="line">input=\u8BF7\u8F93\u5165</span><br><span class="line">info.success=\u6B22\u8FCE\uff0c&#123;0&#125;</span><br><span class="line">info.error=\u767B\u5f55</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Tips:</strong> 在<code>IDEA - File - Settings - Editor - File Encodings</code>，设置<code>Global Encoding/Project Encoding/Properties Files - Default encoding for properties files</code>为 <strong>UTF-8</strong>，并勾选<code>Transparent native-to-ascii conversion</code>。</p>
</blockquote>
<ul>
<li>info_en_US.properties</li>
</ul>
<h2 id="创建本地语言环境对象："><a href="#创建本地语言环境对象：" class="headerlink" title="创建本地语言环境对象："></a>创建本地语言环境对象：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Locale locale = Locale.getDefault();  <span class="comment">//获取默认的系统语言</span></span><br><span class="line"><span class="keyword">if</span> (<span class="string">"zh"</span>.equals(language))</span><br><span class="line">&#123;</span><br><span class="line">    locale = <span class="keyword">new</span> Locale(<span class="string">"zh"</span>, <span class="string">"CN"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"en"</span>.equals(language))</span><br><span class="line">&#123;</span><br><span class="line">    locale = Locale.US;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"language: "</span> + locale.getLanguage() + <span class="string">", country: "</span> + locale.getCountry());</span><br></pre></td></tr></table></figure>
<h1 id="绑定资源文件"><a href="#绑定资源文件" class="headerlink" title="绑定资源文件"></a>绑定资源文件</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ResourceBundle res = ResourceBundle.getBundle(<span class="string">"localize.info"</span>, locale);</span><br></pre></td></tr></table></figure>
<h1 id="读取资源"><a href="#读取资源" class="headerlink" title="读取资源"></a>读取资源</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String input = res.getString(<span class="string">"input"</span>);</span><br><span class="line">String success = MessageFormat.format(res.getString(key), param);  <span class="comment">//动态处理文本</span></span><br></pre></td></tr></table></figure>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.text.MessageFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.ResourceBundle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertiesUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PATH = <span class="string">"config/application.properties"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Properties properties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span></span><br><span class="line">    &#123;</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Properties <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        properties = <span class="keyword">new</span> Properties();</span><br><span class="line"></span><br><span class="line">        InputStream in = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//配置文件在类路径下</span></span><br><span class="line">            in = PropertiesUtil.class.getClassLoader().getResourceAsStream(PATH);</span><br><span class="line">            properties.load(in);</span><br><span class="line">            <span class="comment">//读取任意路径下的配置文件</span></span><br><span class="line">            <span class="comment">//BufferedReader bufferedReader = new BufferedReader(new FileReader("F:/config.properties"));</span></span><br><span class="line">            <span class="comment">//properties.load(bufferedReader);</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Properties not exist."</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Properties load error."</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (in != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    in.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"Close inputStream fail."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getValue</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == key) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> properties.getProperty(key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getResValue</span><span class="params">(String key, String language, String param)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == key) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Locale locale = Locale.getDefault();  <span class="comment">//获取默认的系统语言</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"zh"</span>.equals(language))</span><br><span class="line">            &#123;</span><br><span class="line">                locale = <span class="keyword">new</span> Locale(<span class="string">"zh"</span>, <span class="string">"CN"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"en"</span>.equals(language))</span><br><span class="line">            &#123;</span><br><span class="line">                locale = Locale.US;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"language: "</span> + locale.getLanguage() + <span class="string">", country: "</span> + locale.getCountry());</span><br><span class="line"></span><br><span class="line">            ResourceBundle res = ResourceBundle.getBundle(<span class="string">"localize.info"</span>, locale);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == param)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> res.getString(key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> MessageFormat.format(res.getString(key), param);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(PropertiesUtil.getValue(<span class="string">"exampleKey"</span>));</span><br><span class="line">        System.out.println(PropertiesUtil.getResValue(<span class="string">"name"</span>, <span class="string">"en"</span>, <span class="keyword">null</span>));</span><br><span class="line">        System.out.println(PropertiesUtil.getResValue(<span class="string">"msg"</span>, <span class="string">"zh"</span>, <span class="string">"hello"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/hello-islibra/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/hello-islibra/">1</a><span class="space">&hellip;</span><a class="page-number" href="/hello-islibra/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/hello-islibra/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/hello-islibra/page/8/">8</a><a class="extend next" rel="next" href="/hello-islibra/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">LiXiaolong</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/hello-islibra/archives/">
              
                  <span class="site-state-item-count">76</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LiXiaolong</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/hello-islibra/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/hello-islibra/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/hello-islibra/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/hello-islibra/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/hello-islibra/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/hello-islibra/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/hello-islibra/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/hello-islibra/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/hello-islibra/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
