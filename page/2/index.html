<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/hello-islibra/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/hello-islibra/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/hello-islibra/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/hello-islibra/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/hello-islibra/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/hello-islibra/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/hello-islibra/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Aaron&#39;s horizon">
<meta property="og:url" content="http://islibra.github.io/hello-islibra/page/2/index.html">
<meta property="og:site_name" content="Aaron&#39;s horizon">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Aaron&#39;s horizon">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/hello-islibra/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://islibra.github.io/hello-islibra/page/2/"/>





  <title>Aaron's horizon</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/hello-islibra/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Aaron's horizon</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/hello-islibra/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/hello-islibra/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/10/12/查看操作系统版本/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/10/12/查看操作系统版本/" itemprop="url">查看操作系统版本</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-12T21:21:16+08:00">
                2018-10-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/os/" itemprop="url" rel="index">
                    <span itemprop="name">os</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-uname-a"><a href="#1-uname-a" class="headerlink" title="1. uname -a"></a>1. uname -a</h1><p>查询Linux内核版本</p>
<h1 id="2-cat-proc-version"><a href="#2-cat-proc-version" class="headerlink" title="2. cat /proc/version"></a>2. cat /proc/version</h1><p>查询Linux内核版本</p>
<h1 id="3-cat-etc-issue或cat-etc-redhat-release或cat-etc-SuSE-release"><a href="#3-cat-etc-issue或cat-etc-redhat-release或cat-etc-SuSE-release" class="headerlink" title="3. cat /etc/issue或cat /etc/redhat-release或cat /etc/SuSE-release"></a>3. cat /etc/issue或cat /etc/redhat-release或cat /etc/SuSE-release</h1><p>查询Linux发行版本</p>
<h1 id="4-lsb-release-a"><a href="#4-lsb-release-a" class="headerlink" title="4. lsb_release -a"></a>4. lsb_release -a</h1><p>查询Linux发行版本详细信息</p>
<h1 id="5-getconf-LONG-BIT"><a href="#5-getconf-LONG-BIT" class="headerlink" title="5. getconf LONG_BIT"></a>5. getconf LONG_BIT</h1><p>查询操作系统是32还是64位</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/10/12/Linux磁盘管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/10/12/Linux磁盘管理/" itemprop="url">Linux磁盘管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-12T21:19:38+08:00">
                2018-10-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/os/" itemprop="url" rel="index">
                    <span itemprop="name">os</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="添加磁盘并开机自动挂载"><a href="#添加磁盘并开机自动挂载" class="headerlink" title="添加磁盘并开机自动挂载"></a>添加磁盘并开机自动挂载</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l  <span class="comment">#查看磁盘名称</span></span><br><span class="line">pvcreate /dev/xvde  <span class="comment">#创建PV</span></span><br><span class="line">vgcreate vg1 /dev/xvde  <span class="comment">#创建VG</span></span><br><span class="line">vgdisplay  <span class="comment">#查看VG大小</span></span><br><span class="line">lvcreate -l ***** -n lv1 vg1  <span class="comment">#创建LV，*为VG大小</span></span><br></pre></td></tr></table></figure>
<h2 id="SUSE"><a href="#SUSE" class="headerlink" title="SUSE"></a>SUSE</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext3 -j /dev/vg1/lv1</span><br><span class="line">tune2fs -c 0 -i 0 /dev/vg1/lv1  <span class="comment">#格式化磁盘</span></span><br><span class="line">fdisk -l  <span class="comment">#查看磁盘状态，生成/dev/dm-0</span></span><br><span class="line">mkdir /data  <span class="comment">#创建挂载目录</span></span><br><span class="line">mount /dev/dm-0 /data  <span class="comment">#挂载磁盘（注意如果目录中存在内容，将会被隐藏）</span></span><br><span class="line">vim /etc/fstab  <span class="comment">#重启后自动挂载</span></span><br><span class="line">/dev/dm-0 /data ext3 defaults 0 0  <span class="comment">#在最后一行增加</span></span><br><span class="line">df -h  <span class="comment">#查看磁盘挂载状态</span></span><br></pre></td></tr></table></figure>
<h2 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 -j /dev/vg1/lv1</span><br><span class="line">tune2fs -c 0 -i 0 /dev/vg1/lv1  <span class="comment">#格式化磁盘</span></span><br><span class="line">mkdir /data  <span class="comment">#创建挂载目录</span></span><br><span class="line">mount /dev/vg1/lv1 /data  <span class="comment">#挂载磁盘（注意如果目录中存在内容，将会被隐藏）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"/dev/mapper/vg1-lv1 /data ext4 defaults 0 0"</span> &gt;&gt; /etc/fstab  <span class="comment">#开机自动挂载磁盘</span></span><br></pre></td></tr></table></figure>
<h1 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ll /dev/mapper/</span><br><span class="line">dmsetup remove vg1-lv1</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/10/12/NIO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/10/12/NIO/" itemprop="url">NIO</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-12T21:18:11+08:00">
                2018-10-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Socket通信"><a href="#Socket通信" class="headerlink" title="Socket通信"></a>Socket通信</h1><p>示例代码（服务端）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AaronServer</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ServerSocket serverSocket;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AaronServer</span><span class="params">(<span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            serverSocket = <span class="keyword">new</span> ServerSocket(port);</span><br><span class="line">            serverSocket.setSoTimeout(<span class="number">10000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"waiting for client on port "</span> + serverSocket.getLocalPort() + <span class="string">"..."</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Socket socket = serverSocket.accept();</span><br><span class="line">                System.out.println(<span class="string">"just connected to "</span> + socket.getRemoteSocketAddress());</span><br><span class="line">                DataInputStream in = <span class="keyword">new</span> DataInputStream(socket.getInputStream());</span><br><span class="line">                System.out.println(in.readUTF());</span><br><span class="line"></span><br><span class="line">                DataOutputStream out = <span class="keyword">new</span> DataOutputStream(socket.getOutputStream());</span><br><span class="line">                out.writeUTF(<span class="string">"Thank u for connect to "</span> + socket.getLocalSocketAddress());</span><br><span class="line">                socket.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                System.out.println(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> AaronServer(<span class="number">6066</span>);</span><br><span class="line">        t.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例代码（客户端）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AaronClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"connecting to aaron on port 6066..."</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Socket client = <span class="keyword">new</span> Socket(<span class="string">"127.0.0.1"</span>, <span class="number">6066</span>);</span><br><span class="line">            System.out.println(<span class="string">"just connected to "</span> + client.getRemoteSocketAddress());</span><br><span class="line">            DataOutputStream out = <span class="keyword">new</span> DataOutputStream(client.getOutputStream());</span><br><span class="line">            out.writeUTF(<span class="string">"hello from "</span> + client.getLocalSocketAddress());</span><br><span class="line"></span><br><span class="line">            DataInputStream in = <span class="keyword">new</span> DataInputStream(client.getInputStream());</span><br><span class="line">            System.out.println(<span class="string">"server say: "</span> + in.readUTF());</span><br><span class="line">            client.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="多线程通信"><a href="#多线程通信" class="headerlink" title="多线程通信"></a>多线程通信</h1><p>示例代码（服务端）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HandleMsg</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">        Socket client;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">HandleMsg</span><span class="params">(Socket client)</span></span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.client = client;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            BufferedReader bufferedReader = <span class="keyword">null</span>;</span><br><span class="line">            PrintWriter printWriter = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(client.getInputStream()));</span><br><span class="line">                printWriter = <span class="keyword">new</span> PrintWriter(client.getOutputStream(),<span class="keyword">true</span>);</span><br><span class="line">                String inputLine = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">long</span> a = System.currentTimeMillis();</span><br><span class="line">                <span class="keyword">while</span> ((inputLine = bufferedReader.readLine())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    printWriter.println(inputLine);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">long</span> b = System.currentTimeMillis();</span><br><span class="line">                System.out.println(<span class="string">"Thread cost: "</span> + (b-a) + <span class="string">" seconds."</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                System.out.println(e);</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    bufferedReader.close();</span><br><span class="line">                    printWriter.close();</span><br><span class="line">                    client.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    System.out.println(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">8686</span>);</span><br><span class="line">        Socket client = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            client = server.accept();</span><br><span class="line">            System.out.println(client.getRemoteSocketAddress()+<span class="string">" client connect success."</span>);</span><br><span class="line">            executorService.submit(<span class="keyword">new</span> HandleMsg(client));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例代码（客户端）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Socket client = <span class="keyword">null</span>;</span><br><span class="line">        PrintWriter printWriter = <span class="keyword">null</span>;</span><br><span class="line">        BufferedReader bufferedReader = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client = <span class="keyword">new</span> Socket();</span><br><span class="line">            client.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">"localhost"</span>,<span class="number">8686</span>));</span><br><span class="line">            printWriter = <span class="keyword">new</span> PrintWriter(client.getOutputStream(),<span class="keyword">true</span>);</span><br><span class="line">            printWriter.println(<span class="string">"hello"</span>);</span><br><span class="line">            printWriter.flush();</span><br><span class="line"></span><br><span class="line">            bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(client.getInputStream()));</span><br><span class="line">            System.out.println(<span class="string">"The message from server is: "</span>+bufferedReader.readLine());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            printWriter.close();</span><br><span class="line">            bufferedReader.close();</span><br><span class="line">            client.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="NIO"><a href="#NIO" class="headerlink" title="NIO"></a>NIO</h1><h2 id="核心要素"><a href="#核心要素" class="headerlink" title="核心要素"></a>核心要素</h2><h3 id="Buffer，缓冲区"><a href="#Buffer，缓冲区" class="headerlink" title="Buffer，缓冲区"></a>Buffer，缓冲区</h3><p>数据流向：<code>Client &lt;-data-&gt; Buffer &lt;-data-&gt; Channel &lt;-data-&gt; Channel &lt;-data-&gt; Buffer &lt;-data-&gt; Server</code></p>
<ul>
<li>分配空间：<code>ByteBuffer byteBuffer = ByteBuffer.allocate(1024);</code></li>
<li>从Client向Buffer中写入数据：<code>byteBuffer.put(...);</code></li>
<li>Buffer中的数据写入Channel：<code>channel.write(byteBuffer);</code></li>
<li>Buffer从Channel中读取数据：<code>channel.read(byteBuffer);</code></li>
<li>Server从Buffer中读取数据：<code>byteBuffer.get(...);</code></li>
</ul>
<blockquote>
<ul>
<li>capacity，缓冲区容量</li>
<li>position，当前位置，下一次读取和写入的索引</li>
<li>limit，界限，最后一个有效位置之后的下一个位置的索引</li>
<li>flip()，将limit设置为position，position设置为0</li>
<li>clear()，清空缓冲区</li>
</ul>
</blockquote>
<h3 id="Channel，通道"><a href="#Channel，通道" class="headerlink" title="Channel，通道"></a>Channel，通道</h3><ul>
<li>FileChannel，文件IO</li>
<li>DatagramChannel，UDP协议</li>
<li>ServerSocketChannel/SocketChannel，TCP协议</li>
</ul>
<blockquote>
<p>打开一个ServerSocketChannel通道：<code>ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</code><br>将通道设置为非阻塞：<code>serverSocketChannel.configureBlocking(false);</code><br>循环监听SocketChannel：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">    SocketChannel socketChannel = serverSocketChannel.accept();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>关闭ServerSocketChannel通道：<code>serverSocketChannel.close();</code></p>
</blockquote>
<h3 id="Selector，选择器，通道管理器，选择器允许一个单独的线程来监视多个通道"><a href="#Selector，选择器，通道管理器，选择器允许一个单独的线程来监视多个通道" class="headerlink" title="Selector，选择器，通道管理器，选择器允许一个单独的线程来监视多个通道"></a>Selector，选择器，通道管理器，选择器允许一个单独的线程来监视多个通道</h3><blockquote>
<p>创建并返回一个选择器实例：<code>Selector.open();</code><br>将通道与选择器绑定并注册一个OP_ACCEPT事件：<code>SelectionKey selectionKey = channel.register(selector,SelectionKey.OP_ACCEPT);</code></p>
</blockquote>
<blockquote>
<p><strong>Tips:</strong> Channel和Selector绑定时，Channel必须是非阻塞模式，而FileChannel不能切换到非阻塞模式，因为它不是套接字通道，所以FileChannel不能和Selector绑定事件。</p>
</blockquote>
<blockquote>
<ol>
<li>SelectionKey.OP_CONNECT：连接事件</li>
<li>SelectionKey.OP_ACCEPT：接收事件</li>
<li>SelectionKey.OP_READ：读事件</li>
<li>SelectionKey.OP_WRITE：写事件</li>
</ol>
</blockquote>
<blockquote>
<p>轮询</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">    selector.select();  <span class="comment">//这是一个阻塞方法，一直等待直到有数据可读，返回值是SelectionKey的数量</span></span><br><span class="line">    Set keys = selector.selectedKeys();  <span class="comment">//如果channel有数据了，获取keys集合</span></span><br><span class="line">    Iterator iterator = keys.iterator();</span><br><span class="line">    <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">        SelectionKey key = (SelectionKey) iterator.next();</span><br><span class="line">        iterator.remove();</span><br><span class="line">        <span class="keyword">if</span> (key.isAcceptable())&#123;</span><br><span class="line">            doAccept(key);</span><br><span class="line">        &#125; <span class="keyword">else</span>...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>SelectionKey对象，检测Channel事件类型</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">selectionKey.isAcceptable();</span><br><span class="line">selectionKey.isConnectable();</span><br><span class="line">selectionKey.isReadable();</span><br><span class="line">selectionKey.isWritable();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通过SelectionKey获取Channel和Selector</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Channel  channel  = selectionKey.channel();</span><br><span class="line">Selector selector = selectionKey.selector();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在Channel上注册事件并绑定一个Buffer：<code>clientChannel.register(key.selector(), SelectionKey.OP_READ,ByteBuffer.allocateDirect(1024));</code><br>绑定一个Object：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">selectionKey.attach(Object);</span><br><span class="line">Object anthorObj = selectionKey.attachment();</span><br></pre></td></tr></table></figure>
<h2 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h2><h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectionKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Selector;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.ServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyNioServer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Selector selector;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> port = <span class="number">8686</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> BUF_SIZE = <span class="number">10240</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initServer</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.selector=Selector.open();</span><br><span class="line"></span><br><span class="line">        ServerSocketChannel channel = ServerSocketChannel.open();</span><br><span class="line">        channel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        channel.socket().bind(<span class="keyword">new</span> InetSocketAddress(port));</span><br><span class="line"></span><br><span class="line">        SelectionKey selectionKey = channel.register(selector,SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            selector.select();</span><br><span class="line">            Set keys = selector.selectedKeys();</span><br><span class="line">            Iterator iterator = keys.iterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">                SelectionKey key = (SelectionKey) iterator.next();</span><br><span class="line">                iterator.remove();</span><br><span class="line">                <span class="keyword">if</span> (key.isAcceptable())&#123;</span><br><span class="line">                    doAccept(key);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable())&#123;</span><br><span class="line">                    doRead(key);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (key.isWritable() &amp;&amp; key.isValid())&#123;</span><br><span class="line">                    doWrite(key);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (key.isConnectable())&#123;</span><br><span class="line">                    System.out.println(<span class="string">"Connect success."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccept</span><span class="params">(SelectionKey key)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServerSocketChannel serverChannel = (ServerSocketChannel) key.channel();</span><br><span class="line">        System.out.println(<span class="string">"ServerSocketChannel is listening..."</span>);</span><br><span class="line">        SocketChannel clientChannel = serverChannel.accept();</span><br><span class="line">        clientChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        clientChannel.register(key.selector(),SelectionKey.OP_READ);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doRead</span><span class="params">(SelectionKey key)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        SocketChannel clientChannel = (SocketChannel) key.channel();</span><br><span class="line">        ByteBuffer byteBuffer = ByteBuffer.allocate(BUF_SIZE);</span><br><span class="line">        <span class="keyword">long</span> bytesRead = clientChannel.read(byteBuffer);</span><br><span class="line">        <span class="keyword">while</span> (bytesRead &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            byteBuffer.flip();</span><br><span class="line">            <span class="keyword">byte</span>[] data = byteBuffer.array();</span><br><span class="line">            String info = <span class="keyword">new</span> String(data).trim();</span><br><span class="line">            System.out.println(<span class="string">"The message from client is "</span> + info);</span><br><span class="line">            byteBuffer.clear();</span><br><span class="line">            bytesRead = clientChannel.read(byteBuffer);</span><br><span class="line">        &#125;</span><br><span class="line">        clientChannel.register(key.selector(), SelectionKey.OP_WRITE);</span><br><span class="line">        <span class="comment">/*if (bytesRead == -1)&#123;</span></span><br><span class="line"><span class="comment">            clientChannel.close();</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doWrite</span><span class="params">(SelectionKey key)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ByteBuffer byteBuffer = ByteBuffer.allocate(BUF_SIZE);</span><br><span class="line">        String info = <span class="string">"Hello Client."</span>;</span><br><span class="line">        byteBuffer.clear();</span><br><span class="line">        byteBuffer.put(info.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">        byteBuffer.flip();</span><br><span class="line">        SocketChannel clientChannel = (SocketChannel) key.channel();</span><br><span class="line">        <span class="keyword">while</span> (byteBuffer.hasRemaining())&#123;</span><br><span class="line">            clientChannel.write(byteBuffer);</span><br><span class="line">        &#125;</span><br><span class="line">        byteBuffer.compact();</span><br><span class="line">        clientChannel.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        MyNioServer myNioServer = <span class="keyword">new</span> MyNioServer();</span><br><span class="line">        myNioServer.initServer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectionKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Selector;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyNioClient</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Selector selector;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> port = <span class="number">8686</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> BUF_SIZE = <span class="number">10240</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ByteBuffer byteBuffer = ByteBuffer.allocate(BUF_SIZE);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span>  <span class="title">initClient</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.selector = Selector.open();</span><br><span class="line">        SocketChannel clientChannel = SocketChannel.open();</span><br><span class="line">        clientChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        clientChannel.connect(<span class="keyword">new</span> InetSocketAddress(port));</span><br><span class="line">        clientChannel.register(selector, SelectionKey.OP_CONNECT);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            selector.select();</span><br><span class="line">            Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">                SelectionKey key = iterator.next();</span><br><span class="line">                iterator.remove();</span><br><span class="line">                <span class="keyword">if</span> (key.isConnectable())&#123;</span><br><span class="line">                    doConnect(key);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable())&#123;</span><br><span class="line">                    doRead(key);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doConnect</span><span class="params">(SelectionKey key)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        SocketChannel clientChannel = (SocketChannel) key.channel();</span><br><span class="line">        <span class="keyword">if</span> (clientChannel.isConnectionPending())&#123;</span><br><span class="line">            clientChannel.finishConnect();</span><br><span class="line">        &#125;</span><br><span class="line">        clientChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        String info = <span class="string">"Hello Server."</span>;</span><br><span class="line">        byteBuffer.clear();</span><br><span class="line">        byteBuffer.put(info.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">        byteBuffer.flip();</span><br><span class="line">        clientChannel.write(byteBuffer);</span><br><span class="line">        clientChannel.register(key.selector(),SelectionKey.OP_READ);</span><br><span class="line">        <span class="comment">//clientChannel.close();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doRead</span><span class="params">(SelectionKey key)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        SocketChannel clientChannel = (SocketChannel) key.channel();</span><br><span class="line">        byteBuffer.clear();</span><br><span class="line">        clientChannel.read(byteBuffer);</span><br><span class="line">        byteBuffer.flip();</span><br><span class="line">        <span class="keyword">byte</span>[] data = byteBuffer.array();</span><br><span class="line">        String msg = <span class="keyword">new</span> String(data).trim();</span><br><span class="line">        System.out.println(<span class="string">"Received message from server: "</span> + msg);</span><br><span class="line">        clientChannel.close();</span><br><span class="line">        <span class="comment">//key.selector().close();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        MyNioClient myNioClient = <span class="keyword">new</span> MyNioClient();</span><br><span class="line">        myNioClient.initClient();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考文献：<a href="https://segmentfault.com/a/1190000012316621" target="_blank" rel="noopener">Java NIO详解</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/10/12/字符编码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/10/12/字符编码/" itemprop="url">字符编码</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-12T21:13:14+08:00">
                2018-10-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ASCII"><a href="#ASCII" class="headerlink" title="ASCII"></a>ASCII</h1><p>一个字节BYTE有8位二进制bit，可表示范围<code>0~255</code>。<br>ASCII采用（第一位为0）7位128个值（0~127）编码26个英文字母、10个数字、32个特殊字符、33个控制字符和1个空格。其中：</p>
<ul>
<li><code>0~31</code> / <code>0x00~0x1F</code>和<code>127</code> / <code>0x7F</code>共33个，代表控制字符，不可显示。如8=BS（退格）、9=HT（水平制表符）、10=LF（换行）、13=CR（回车）、127=DEL（删除）</li>
</ul>
<blockquote>
<p><strong>Tips:</strong> 回车\r使光标重新回到本行开头，换行\n使光标往下一行。Windows中使用\r\n，UNIX中使用\n，MAC中使用\r。</p>
</blockquote>
<ul>
<li><code>32</code> / <code>0x20</code>，代表空格</li>
<li><code>33~47</code> / <code>0x21~0x2F</code>、<code>58~64</code> / <code>0x3A~0x40</code>、<code>91~96</code> / <code>0x5B~0x60</code>、<code>123~126</code> / <code>0x7B~0x7E</code>共32个，代表`~!@#$%^&amp;*()-_=+|[{}];:’”,&lt;.&gt;/?特殊字符</li>
<li><code>48~57</code> / <code>0x30~0x39</code>共10个，代表0~9数字</li>
<li><code>65~90</code> / <code>0x41~0x5A</code>共26个，代表A~Z大写字母</li>
<li><code>97~122</code> / <code>0x61~0x7A</code>共26个，代表a~z小写字母</li>
</ul>
<h1 id="ISO-8859-1-Latin-1"><a href="#ISO-8859-1-Latin-1" class="headerlink" title="ISO-8859-1(Latin-1)"></a>ISO-8859-1(Latin-1)</h1><p>单字节编码，<code>0x00~0x7F</code>为ASCII编码，其他为欧洲语言。</p>
<h1 id="GB2312"><a href="#GB2312" class="headerlink" title="GB2312"></a>GB2312</h1><p>简体中文编码方式，使用两个字节代表一个汉字，可表示范围<code>0~65535</code>。英文字母和ISO-8859-1一致。<br>GBK包含简体中文和繁体中文。</p>
<blockquote>
<p><strong>Tips:</strong> ANSI是Windows默认的编码方式，扩展了ASCII编码，使用<code>0x00~0x7F</code>表示ASCII编码，<code>0x80~0xFFFF</code>表示其他语言的字符，比如简体中文GB2312编码，不同语言之间的ANSI编码不能互相转换。</p>
</blockquote>
<h1 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h1><p>统一字符编码，规定了所有字符与二进制的对应关系。<strong>字符串在Java内存中总是按Unicode编码存储。</strong></p>
<h2 id="UCS-2"><a href="#UCS-2" class="headerlink" title="UCS-2"></a>UCS-2</h2><p>直接使用两个字节存储Unicode编码。</p>
<ul>
<li>little endian，小头方式（倒序），即低8位在前，高8位在后。文件中BOM前两个字节是FF FE表示。</li>
<li>big endian，大头方式（正序），文件中BOM前两个字节是FE FF表示。</li>
</ul>
<blockquote>
<p><strong>Tips:</strong> BOM在Windows中是字节顺序标记，用来区分大头还是小头。</p>
</blockquote>
<h2 id="UTF-8"><a href="#UTF-8" class="headerlink" title="UTF-8"></a>UTF-8</h2><p>Unicode字符在计算机中的存储方式，使用1~4个字节变长存储。文件中BOM前三个字节是EF BB BF表示。</p>
<ul>
<li>对于单字节符号，第一位为0，后7位为Unicode编码。对于英文字母，UTF-8 = ASCII。</li>
<li>对于n字节符号，第一个字节前n位为1，n+1位为0，后面字节前两位为10，其他位为Unicode编码。中文一般为3个字节。</li>
</ul>
<table>
<thead>
<tr>
<th>Unicode符号范围（十六进制）</th>
<th>UTF-8编码方式（二进制）</th>
</tr>
</thead>
<tbody>
<tr>
<td>0000 0000-0000 007F</td>
<td>0xxxxxxx</td>
</tr>
<tr>
<td>0000 0080-0000 07FF</td>
<td>110xxxxx 10xxxxxx</td>
</tr>
<tr>
<td>0000 0800-0000 FFFF</td>
<td>1110xxxx 10xxxxxx 10xxxxxx</td>
</tr>
<tr>
<td>0001 0000-0010 FFFF</td>
<td>11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</td>
</tr>
</tbody>
</table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/16/搜狗输入法自定义短语/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/16/搜狗输入法自定义短语/" itemprop="url">搜狗输入法自定义短语</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-16T14:13:11+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/environment/" itemprop="url" rel="index">
                    <span itemprop="name">environment</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>菜单 - 设置属性 - 高级 - 自定义短语设置 - 添加新定义</p>
<ul>
<li><code>缩写</code>为输入的拼音或简写</li>
<li><code>该条短语在候选中的位置</code></li>
<li>文本框中添加需要自定义的短语</li>
</ul>
<p>直接编辑配置文件，格式为<code>zhanghao,1=帐号</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/16/SQL基本数据类型/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/16/SQL基本数据类型/" itemprop="url">SQL基本数据类型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-16T14:10:44+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/db/" itemprop="url" rel="index">
                    <span itemprop="name">db</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="文本"><a href="#文本" class="headerlink" title="文本"></a>文本</h2><table>
<thead>
<tr>
<th>是否常用</th>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>***</td>
<td>CHAR(size)</td>
<td>保存固定长度的字符串（可包含字母、数字以及特殊字符）。在括号中指定字符串的长度。最多 255 个字符。</td>
</tr>
<tr>
<td>***</td>
<td>VARCHAR(size)</td>
<td>保存可变长度的字符串（可包含字母、数字以及特殊字符）。在括号中指定字符串的最大长度。最多 255 个字符。注释：如果值的长度大于 255，则被转换为 TEXT 类型。</td>
</tr>
<tr>
<td>-</td>
<td>TINYTEXT</td>
<td>存放最大长度为 255 个字符的字符串。</td>
</tr>
<tr>
<td>-</td>
<td>TEXT</td>
<td>存放最大长度为 65,535 个字符的字符串。</td>
</tr>
<tr>
<td>-</td>
<td>BLOB</td>
<td>用于 BLOBs (Binary Large OBjects)。存放最多 65,535 字节的数据。</td>
</tr>
<tr>
<td>-</td>
<td>MEDIUMTEXT</td>
<td>存放最大长度为 16,777,215 个字符的字符串。</td>
</tr>
<tr>
<td>-</td>
<td>MEDIUMBLOB</td>
<td>用于 BLOBs (Binary Large OBjects)。存放最多 16,777,215 字节的数据。</td>
</tr>
<tr>
<td>-</td>
<td>LONGTEXT</td>
<td>存放最大长度为 4,294,967,295 个字符的字符串。</td>
</tr>
<tr>
<td>-</td>
<td>LONGBLOB</td>
<td>用于 BLOBs (Binary Large OBjects)。存放最多 4,294,967,295 字节的数据。</td>
</tr>
<tr>
<td>-</td>
<td>ENUM(x,y,z,etc.)</td>
<td>允许你输入可能值的列表。可以在 ENUM 列表中列出最大 65535 个值。如果列表中不存在插入的值，则插入空值。注释：这些值是按照你输入的顺序存储的。可以按照此格式输入可能的值：ENUM(‘X’,’Y’,’Z’)</td>
</tr>
<tr>
<td>-</td>
<td>SET</td>
<td>与 ENUM 类似，SET 最多只能包含 64 个列表项，不过 SET 可存储一个以上的值。</td>
</tr>
</tbody>
</table>
<h2 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h2><table>
<thead>
<tr>
<th>是否常用</th>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>-</td>
<td>TINYINT(size)</td>
<td>-128 到 127 常规。0 到 255 无符号*。在括号中规定最大位数。</td>
</tr>
<tr>
<td>-</td>
<td>SMALLINT(size)</td>
<td>-32768 到 32767 常规。0 到 65535 无符号*。在括号中规定最大位数。</td>
</tr>
<tr>
<td>-</td>
<td>MEDIUMINT(size)</td>
<td>-8388608 到 8388607 普通。0 to 16777215 无符号*。在括号中规定最大位数。</td>
</tr>
<tr>
<td>***</td>
<td>INT(size)</td>
<td>-2147483648 到 2147483647 常规。0 到 4294967295 无符号*。在括号中规定最大位数。</td>
</tr>
<tr>
<td>-</td>
<td>BIGINT(size)</td>
<td>-9223372036854775808 到 9223372036854775807 常规。0 到 18446744073709551615 无符号*。在括号中规定最大位数。</td>
</tr>
<tr>
<td>-</td>
<td>FLOAT(size,d)</td>
<td>带有浮动小数点的小数字。在括号中规定最大位数。在 d 参数中规定小数点右侧的最大位数。</td>
</tr>
<tr>
<td>-</td>
<td>DOUBLE(size,d)</td>
<td>带有浮动小数点的大数字。在括号中规定最大位数。在 d 参数中规定小数点右侧的最大位数。</td>
</tr>
<tr>
<td>-</td>
<td>DECIMAL(size,d)</td>
<td>作为字符串存储的 DOUBLE 类型，允许固定的小数点。</td>
</tr>
</tbody>
</table>
<h2 id="日期-时间"><a href="#日期-时间" class="headerlink" title="日期/时间"></a>日期/时间</h2><table>
<thead>
<tr>
<th>是否常用</th>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>-</td>
<td>DATE()</td>
<td>日期。格式：YYYY-MM-DD。注释：支持的范围是从 ‘1000-01-01’ 到 ‘9999-12-31’</td>
</tr>
<tr>
<td>-</td>
<td>DATETIME()</td>
<td>*日期和时间的组合。格式：YYYY-MM-DD HH:MM:SS。注释：支持的范围是从 ‘1000-01-01 00:00:00’ 到 ‘9999-12-31 23:59:59’</td>
</tr>
<tr>
<td>-</td>
<td>TIMESTAMP()</td>
<td>*时间戳。TIMESTAMP 值使用 Unix 纪元(‘1970-01-01 00:00:00’ UTC) 至今的描述来存储。格式：YYYY-MM-DD HH:MM:SS。注释：支持的范围是从 ‘1970-01-01 00:00:01’ UTC 到 ‘2038-01-09 03:14:07’ UTC</td>
</tr>
<tr>
<td>-</td>
<td>TIME()</td>
<td>时间。格式：HH:MM:SS 注释：支持的范围是从 ‘-838:59:59’ 到 ‘838:59:59’</td>
</tr>
<tr>
<td>-</td>
<td>YEAR()</td>
<td>2 位或 4 位格式的年。注释：4 位格式所允许的值：1901 到 2155。2 位格式所允许的值：70 到 69，表示从 1970 到 2069。</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Tips:</strong> 在 INSERT 或 UPDATE 查询中，TIMESTAMP 自动把自身设置为当前的日期和时间。</p>
</blockquote>
<h1 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h1><h2 id="常见文本存储类型及使用"><a href="#常见文本存储类型及使用" class="headerlink" title="常见文本存储类型及使用"></a>常见文本存储类型及使用</h2><ul>
<li>char：char是定长的，也就是当你输入的字符小于你指定的数目时，char(8)，你输入的字符小于8时，它会再后面补空值。当你输入的字符大于指定的数时，它会截取超出的字符。CHAR存储定长数据很方便，CHAR字段上的索引效率级高，比如定义char(10)，那么不论你存储的数据是否达到了10个字节，都要占去10个字节的空间。</li>
<li>varchar[(n)]：长度为n个字节的可变长度且非Unicode的字符数据。n必须是一个介于1和8,000之间的数值。存储大小为输入数据的字节的实际长度，而不是n个字节。所输入的数据字符长度可以为零。存储变长数据，但存储效率没有CHAR高。如果一个字段可能的值是不固定长度的，我们只知道它不可能超过10个字符，把它定义为VARCHAR(10)是最合算的。VARCHAR类型的实际长度是它的值的实际长度+1。为什么“+1”呢？这一个字节用于保存实际使用了多大的长度。从空间上考虑，用varchar合适；从效率上考虑，用char合适，关键是根据实际情况找到权衡点。</li>
<li>TEXT。text存储可变长度的非Unicode数据，最大长度为2^31-1(2,147,483,647)个字符。</li>
<li>nvarchar(n)：包含n个字符的可变长度Unicode字符数据。n的值必须介于1与4,000之间。字节的存储大小是所输入字符个数的两倍。所输入的数据字符长度可以为零。NCHAR、NVARCHAR、NTEXT这三种从名字上看比前面三种多了个“N”。它表示存储的是Unicode数据类型的字符。我们知道字符中，英文字符只需要一个字节存储就足够了，但汉字众多，需要两个字节存储，英文与汉字同时存在时容易造成混乱，Unicode字符集就是为了解决字符集这种不兼容的问题而产生的，它所有的字符都用两个字节表示，即英文字符也是用两个字节表示。nchar、nvarchar的长度是在1到4000之间。和char、varchar比较起来，nchar、nvarchar则最多存储4000个字符，不论是英文还是汉字；而char、varchar最多能存储8000个英文，4000个汉字。可以看出使用nchar、nvarchar数据类型时不用担心输入的字符是英文还是汉字，较为方便，但在存储英文时数量上有些损失。所以一般来说，如果含有中文字符，用nchar/nvarchar，如果纯英文和数字，用char/varchar。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/16/SQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/16/SQL/" itemprop="url">SQL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-16T14:09:20+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/db/" itemprop="url" rel="index">
                    <span itemprop="name">db</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>Tips:</strong> SQL 对大小写不敏感！</p>
</blockquote>
<h1 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h1><ul>
<li>SELECT 列名称 FROM 表名称<ul>
<li>SELECT <strong>DISTINCT</strong> column1, column2, … FROM table_name;  //去重</li>
<li>SELECT ID <strong>AS</strong> CUSTOMER_ID, NAME <strong>AS</strong> CUSTOMER_NAME FROM CUSTOMERS;  //列别名</li>
<li>SELECT C.ID, C.NAME, C.AGE, O.AMOUNT FROM CUSTOMERS AS C, ORDERS AS O WHERE C.ID = O.CUSTOMER_ID;  //表别名</li>
</ul>
</li>
<li>UPDATE 表名称 SET 列1名称 = 新值1[, 列2名称 = 新值2] WHERE 列名称 = 某值</li>
<li>DELETE FROM 表名称 WHERE 列名称 = 值</li>
<li>INSERT INTO table_name [(列1, 列2,…)] VALUES (值1, 值2,….)</li>
</ul>
<blockquote>
<p><strong>WARNING!</strong> DELETE不加WHERE子句就会删除表中全部数据！</p>
</blockquote>
<h2 id="WHERE子句"><a href="#WHERE子句" class="headerlink" title="WHERE子句"></a>WHERE子句</h2><p>SELECT 列名称 FROM 表名称 <strong>WHERE 列 运算符 值</strong></p>
<h3 id="运算符用法："><a href="#运算符用法：" class="headerlink" title="运算符用法："></a>运算符用法：</h3><ul>
<li>=  !=  &gt;  &gt;=  &lt;  &lt;=，例：<ul>
<li><code>WHERE City=&#39;Beijing&#39;</code></li>
<li><code>WHERE Year&gt;1965</code></li>
</ul>
</li>
<li>BETWEEN，例：<code>SELECT column_name(s) FROM table_name WHERE column_name BETWEEN value1 AND value2;</code>，适用于文本、数值或日期。</li>
<li>LIKE，％ 百分号表示零个，一个或多个字符；_ 下划线表示单个字符；[charlist] 表示字符列中的任一字符；[^charlist]或[!charlist] 表示不在字符列中的任一字符。例：<ul>
<li><code>SELECT * FROM Customers WHERE CustomerName LIKE &#39;a%&#39;;</code></li>
<li><code>SELECT * FROM Customers WHERE CustomerName LIKE &#39;_r%&#39;;</code></li>
<li><code>SELECT * FROM Persons WHERE City NOT LIKE &#39;%lon%&#39;</code></li>
<li><code>SELECT * FROM Persons WHERE City LIKE &#39;[ALN]%&#39;</code>，以A或L或N开头的任意字符串</li>
</ul>
</li>
<li>IS，例：<ul>
<li>测试空值：<code>SELECT column_names FROM table_name WHERE column_name IS [NOT] NULL;</code></li>
</ul>
</li>
<li>IN，例：<code>SELECT column_name(s) FROM table_name WHERE column_name IN (value1,value2,...);</code></li>
</ul>
<blockquote>
<p><strong>Tips:</strong> 文本使用单引号，数值不使用引号！</p>
</blockquote>
<h3 id="AND和OR"><a href="#AND和OR" class="headerlink" title="AND和OR"></a>AND和OR</h3><ul>
<li>SELECT * FROM Persons WHERE FirstName=’Thomas’ AND LastName=’Carter’</li>
<li>SELECT * FROM Persons WHERE firstname=’Thomas’ OR lastname=’Carter’</li>
<li>SELECT * FROM Persons WHERE (FirstName=’Thomas’ OR FirstName=’William’) AND LastName=’Carter’</li>
</ul>
<h2 id="ORDER-BY"><a href="#ORDER-BY" class="headerlink" title="ORDER BY"></a>ORDER BY</h2><p>SELECT 列名称 FROM 表名称 <strong>ORDER BY 列1 [ASC/DESC], 列2 [ASC/DESC]</strong></p>
<h2 id="TOP子句"><a href="#TOP子句" class="headerlink" title="TOP子句"></a>TOP子句</h2><ul>
<li>SQL Server: <code>SELECT TOP number|percent column_name(s) FROM table_name WHERE condition;</code>，例：<ul>
<li>SELECT TOP 2 * FROM Persons</li>
<li>SELECT TOP 50 PERCENT * FROM Persons</li>
</ul>
</li>
<li>MySQL: <code>SELECT column_name(s) FROM table_name LIMIT number;</code>，例：<ul>
<li>SELECT User from user limit 2;  /<em> 只查询2条数据 </em>/</li>
<li>SELECT User from user limit 2,3;  /<em> 从偏移量2开始查询3条数据，偏移量从0开始 </em>/</li>
</ul>
</li>
<li>Oracle: <code>SELECT column_name(s) FROM table_name WHERE ROWNUM &lt;= number;</code></li>
</ul>
<blockquote>
<p><strong>Tips:</strong> 如果只查询一条记录，可以加上LIMIT 1，避免全表扫描。在偏移量大的时候limit执行效率降低，应优先使用where子句，配合limit使用。</p>
</blockquote>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>SELECT function(列) FROM 表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(OrderPrice) <span class="keyword">AS</span> OrderAverage <span class="keyword">FROM</span> Orders;</span><br><span class="line"><span class="keyword">SELECT</span> Customer <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> OrderPrice&gt;(<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(OrderPrice) <span class="keyword">FROM</span> Orders)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(Customer) <span class="keyword">AS</span> CustomerNilsen <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> Customer=<span class="string">'Carter'</span></span><br><span class="line"><span class="comment">/* 类似用法：FIRST\LAST\MAX\MIN\SUM\UCASE\LCASE\LEN */</span></span><br><span class="line"><span class="comment">/* 获取子字符串 */</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MID</span>(City,<span class="number">1</span>,<span class="number">3</span>) <span class="keyword">as</span> SmallCity <span class="keyword">FROM</span> Persons;  <span class="comment">/* SELECT MID(column_name,start[,length]) FROM table_name */</span></span><br><span class="line"><span class="comment">/* 把数值字段舍入为指定的小数位数 */</span></span><br><span class="line"><span class="keyword">SELECT</span> ProductName, <span class="keyword">ROUND</span>(UnitPrice,<span class="number">0</span>) <span class="keyword">as</span> UnitPrice <span class="keyword">FROM</span> Products;  <span class="comment">/* SELECT ROUND(column_name,decimals) FROM table_name */</span></span><br><span class="line"><span class="comment">/* 获取当前时间 */</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NOW</span>() <span class="keyword">FROM</span> table_name;</span><br><span class="line"><span class="comment">/* 格式化 */</span></span><br><span class="line"><span class="keyword">SELECT</span> ProductName, UnitPrice, <span class="keyword">FORMAT</span>(<span class="keyword">Now</span>(),<span class="string">'YYYY-MM-DD'</span>) <span class="keyword">as</span> PerDate <span class="keyword">FROM</span> Products;</span><br></pre></td></tr></table></figure>
<h3 id="GROUP-BY"><a href="#GROUP-BY" class="headerlink" title="GROUP BY"></a>GROUP BY</h3><p>SELECT column_name1, column_name2, aggregate_function(column_name3) FROM table_name GROUP BY column_name1, column_name2;<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Customer,<span class="keyword">SUM</span>(OrderPrice) <span class="keyword">FROM</span> Orders <span class="keyword">GROUP</span> <span class="keyword">BY</span> Customer;</span><br></pre></td></tr></table></figure></p>
<h3 id="HAVING"><a href="#HAVING" class="headerlink" title="HAVING"></a>HAVING</h3><p>WHERE 关键字无法与合计函数一起使用，HAVING 子句对GROUP BY子句过滤。<br>SELECT column_name, aggregate_function(column_name) FROM table_name WHERE column_name operator value GROUP BY column_name HAVING aggregate_function(column_name) operator value;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Customer,<span class="keyword">SUM</span>(OrderPrice) <span class="keyword">FROM</span> Orders <span class="keyword">GROUP</span> <span class="keyword">BY</span> Customer <span class="keyword">HAVING</span> <span class="keyword">SUM</span>(OrderPrice)&lt;<span class="number">2000</span>;</span><br></pre></td></tr></table></figure>
<h2 id="JOIN"><a href="#JOIN" class="headerlink" title="JOIN"></a>JOIN</h2><ul>
<li>[INNER] JOIN: <code>SELECT column_name(s) FROM table_name1 INNER JOIN table_name2 ON table_name1.column_name=table_name2.column_name;</code>，所有表中的数据都匹配（不为空）才会显示。<ul>
<li>例：<code>SELECT Persons.LastName, Persons.FirstName, Orders.OrderNo FROM Persons INNER JOIN Orders ON Persons.Id_P = Orders.Id_P;</code></li>
<li>相当于：<code>SELECT Persons.LastName, Persons.FirstName, Orders.OrderNo FROM Persons, Orders WHERE Persons.Id_P = Orders.Id_P;</code></li>
</ul>
</li>
<li>LEFT [OUTER] JOIN: <code>SELECT column_name(s) FROM table_name1 LEFT JOIN table_name2 ON table_name1.column_name=table_name2.column_name</code>，从左表返回所有的行。</li>
<li>RIGHT [OUTER] JOIN: <code>SELECT column_name(s) FROM table_name1 RIGHT JOIN table_name2 ON table_name1.column_name=table_name2.column_name</code>，从右表返回所有的行。</li>
<li>FULL [OUTER] JOIN: <code>SELECT column_name(s) FROM table_name1 FULL JOIN table_name2 ON table_name1.column_name=table_name2.column_name</code>，返回所有表中的所有行。</li>
</ul>
<h2 id="UNION"><a href="#UNION" class="headerlink" title="UNION"></a>UNION</h2><blockquote>
<p><strong>WARNING!</strong> UNION用于合并两个或多个SELECT语句的结果集，必须拥有相同数量、类型、顺序的列。</p>
</blockquote>
<ul>
<li>UNION: <code>SELECT column_name(s) FROM table_name1 UNION SELECT column_name(s) FROM table_name2;</code>，去除重复值。</li>
<li>UNION ALL: <code>SELECT column_name(s) FROM table_name1 UNION ALL SELECT column_name(s) FROM table_name2;</code>，保留全部值。</li>
</ul>
<blockquote>
<p><strong>Tips1:</strong> 结果集中的列名总是等于 UNION 中第一个 SELECT 语句中的列名。</p>
</blockquote>
<blockquote>
<p><strong>Tips2:</strong> 跨表查询的方法：</p>
<ul>
<li>SELECT column_name(s) FROM table_name WHERE column_name IN (SELECT STATEMENT);</li>
<li>SELECT Orders.OrderID, Customers.CustomerName, Orders.OrderDate FROM Orders INNER JOIN Customers ON Orders.CustomerID=Customers.CustomerID;</li>
<li>SELECT Customers.CustomerName, Orders.OrderID FROM Customers LEFT JOIN Orders ON Customers.CustomerID = Orders.CustomerID ORDER BY Customers.CustomerName;</li>
<li>SELECT Orders.OrderID, Employees.LastName, Employees.FirstName FROM Orders RIGHT JOIN Employees ON Orders.EmployeeID = Employees.EmployeeID ORDER BY Orders.OrderID;</li>
<li>SELECT City, Country FROM Customers WHERE Country=’Germany’ UNION SELECT City, Country FROM Suppliers WHERE Country=’Germany’ ORDER BY City;</li>
</ul>
</blockquote>
<h2 id="复制表数据"><a href="#复制表数据" class="headerlink" title="复制表数据"></a>复制表数据</h2><ul>
<li>SELECT INTO: <code>SELECT column_name(s) INTO new_table_name [IN externaldatabase] FROM old_tablename;</code>，可以使用IN关键字拷贝到另一个数据库中。例：<ul>
<li>SELECT * INTO CustomersBackup2013 FROM Customers WHERE Country=’Germany’;</li>
</ul>
</li>
<li>INSERT INTO SELECT<ul>
<li>INSERT INTO Customers (CustomerName, Country) SELECT SupplierName, Country FROM Suppliers WHERE Country=’Germany’;</li>
</ul>
</li>
</ul>
<h1 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h1><ul>
<li>CREATE DATABASE database_name</li>
<li>ALTER DATABASE</li>
<li>DROP DATABASE database_name</li>
<li>CREATE TABLE Persons<br>(<br>PersonID int,<br>LastName varchar(255),<br>FirstName varchar(255),<br>Address varchar(255),<br>City varchar(255)<br>);</li>
<li>ALTER TABLE<ul>
<li>ALTER TABLE table_name ADD column_name datatype</li>
<li>ALTER TABLE table_name DROP COLUMN column_name</li>
<li>ALTER TABLE table_name ALTER COLUMN column_name datatype，SQL Server</li>
<li>ALTER TABLE table_name MODIFY COLUMN column_name datatype，Oracle</li>
</ul>
</li>
<li>DROP TABLE table_name</li>
<li>CREATE INDEX index_name ON table_name (column_name)</li>
<li><p>DROP INDEX</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Microsoft Access */</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> table_name</span><br><span class="line"><span class="comment">/* MS SQL Server */</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> table_name.index_name</span><br><span class="line"><span class="comment">/* Oracle */</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_name</span><br><span class="line"><span class="comment">/* MySQL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">DROP</span> <span class="keyword">INDEX</span> index_name</span><br></pre></td></tr></table></figure>
</li>
<li><p>TRUNCATE TABLE table_name，清空表中数据。</p>
</li>
</ul>
<h2 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h2><h3 id="NOT-NULL，字段非空。例："><a href="#NOT-NULL，字段非空。例：" class="headerlink" title="NOT NULL，字段非空。例："></a>NOT NULL，字段非空。例：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="UNIQUE，字段唯一。例："><a href="#UNIQUE，字段唯一。例：" class="headerlink" title="UNIQUE，字段唯一。例："></a>UNIQUE，字段唯一。例：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* MySQL */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">UNIQUE</span> (Id_P)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">P_Id <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 命名 UNIQUE 约束，并为多个列定义 UNIQUE 约束，MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">P_Id <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> uc_PersonID <span class="keyword">UNIQUE</span> (P_Id,LastName)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 增加约束，MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> (Id_P);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uc_PersonID <span class="keyword">UNIQUE</span> (P_Id,LastName)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 撤销 UNIQUE 约束，MySQL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">DROP</span> <span class="keyword">INDEX</span> uc_PersonID</span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> uc_PersonID</span><br></pre></td></tr></table></figure>
<h3 id="PRIMARY-KEY，主键，唯一，非空，有且只有一个主键字段。例："><a href="#PRIMARY-KEY，主键，唯一，非空，有且只有一个主键字段。例：" class="headerlink" title="PRIMARY KEY，主键，唯一，非空，有且只有一个主键字段。例："></a>PRIMARY KEY，主键，唯一，非空，有且只有一个主键字段。例：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* MySQL */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (Id_P)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 命名 PRIMARY KEY 约束，并为多个列定义 PRIMARY KEY 约束，MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> pk_PersonID PRIMARY <span class="keyword">KEY</span> (Id_P,LastName)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 增加主键，MySQL / SQL Server / Oracle / MS Access，增加主键的字段必须在创建表时NOT NULL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span> (Id_P)</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_PersonID PRIMARY <span class="keyword">KEY</span> (Id_P,LastName)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 撤销 PRIMARY KEY 约束，MySQL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span></span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> pk_PersonID</span><br></pre></td></tr></table></figure>
<h3 id="FOREIGN-KEY，外键，指向另一个表中的-PRIMARY-KEY。例："><a href="#FOREIGN-KEY，外键，指向另一个表中的-PRIMARY-KEY。例：" class="headerlink" title="FOREIGN KEY，外键，指向另一个表中的 PRIMARY KEY。例："></a>FOREIGN KEY，外键，指向另一个表中的 PRIMARY KEY。例：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* MySQL */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">Id_O <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">Id_P <span class="built_in">int</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (Id_O),</span><br><span class="line">FOREIGN <span class="keyword">KEY</span> (Id_P) <span class="keyword">REFERENCES</span> Persons(Id_P)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">O_Id <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">P_Id <span class="built_in">int</span> FOREIGN <span class="keyword">KEY</span> <span class="keyword">REFERENCES</span> Persons(P_Id)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 命名 FOREIGN KEY 约束，并为多个列定义 FOREIGN KEY 约束，MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">O_Id <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">P_Id <span class="built_in">int</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (O_Id),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> fk_PerOrders FOREIGN <span class="keyword">KEY</span> (P_Id) <span class="keyword">REFERENCES</span> Persons(P_Id)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 增加 FOREIGN KEY 约束，MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Orders <span class="keyword">ADD</span> FOREIGN <span class="keyword">KEY</span> (Id_P) <span class="keyword">REFERENCES</span> Persons(Id_P)</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Orders <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_PerOrders FOREIGN <span class="keyword">KEY</span> (P_Id) <span class="keyword">REFERENCES</span> Persons(P_Id)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 撤销 FOREIGN KEY 约束，MySQL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Orders <span class="keyword">DROP</span> FOREIGN <span class="keyword">KEY</span> fk_PerOrders</span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Orders <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> fk_PerOrders</span><br></pre></td></tr></table></figure>
<h3 id="CHECK，限制列中的值的范围。例："><a href="#CHECK，限制列中的值的范围。例：" class="headerlink" title="CHECK，限制列中的值的范围。例："></a>CHECK，限制列中的值的范围。例：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* My SQL */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">CHECK</span> (Id_P&gt;<span class="number">0</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">CHECK</span> (Id_P&gt;<span class="number">0</span>),</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 命名 CHECK 约束，并为多个列定义 CHECK 约束，MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> chk_Person <span class="keyword">CHECK</span> (Id_P&gt;<span class="number">0</span> <span class="keyword">AND</span> City=<span class="string">'Sandnes'</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 新增CHECK约束，MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ADD</span> <span class="keyword">CHECK</span> (Id_P&gt;<span class="number">0</span>)</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> chk_Person <span class="keyword">CHECK</span> (Id_P&gt;<span class="number">0</span> <span class="keyword">AND</span> City=<span class="string">'Sandnes'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 撤销 CHECK 约束，MySQL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">DROP</span> <span class="keyword">CHECK</span> chk_Person</span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> chk_Person</span><br></pre></td></tr></table></figure>
<h3 id="DEFAULT，向列中插入默认值。例："><a href="#DEFAULT，向列中插入默认值。例：" class="headerlink" title="DEFAULT，向列中插入默认值。例："></a>DEFAULT，向列中插入默认值。例：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* MySQL / SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">'Sandnes'</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 自动插入系统值 */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">Id_O <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">Id_P <span class="built_in">int</span>,</span><br><span class="line">OrderDate <span class="built_in">date</span> <span class="keyword">DEFAULT</span> <span class="keyword">GETDATE</span>()</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 新增 DEFAULT 约束，MySQL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ALTER</span> City <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="string">'SANDNES'</span></span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> City <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="string">'SANDNES'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 撤销 DEFAULT 约束，MySQL */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ALTER</span> City <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span></span><br><span class="line"><span class="comment">/* SQL Server / Oracle / MS Access */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> City <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span></span><br></pre></td></tr></table></figure>
<h2 id="自增字段"><a href="#自增字段" class="headerlink" title="自增字段"></a>自增字段</h2><h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">P_Id <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,  <span class="comment">/* 默认起始值为1，递增1 */</span></span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (P_Id)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 修改起始值 */</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons AUTO_INCREMENT=<span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 添加记录时不指定自增字段的值 */</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Persons (FirstName,LastName) <span class="keyword">VALUES</span> (<span class="string">'Bill'</span>,<span class="string">'Gates'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="SQL-Server"><a href="#SQL-Server" class="headerlink" title="SQL Server"></a>SQL Server</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">P_Id <span class="built_in">int</span> PRIMARY <span class="keyword">KEY</span> <span class="keyword">IDENTITY</span>,  <span class="comment">/* 使用IDENTITY(20,10)更改起始值和递增值 */</span></span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 使用序列（ sequence ）对象（该对象生成数字序列）创建自动增量（ auto-increment ）字段。 */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">SEQUENCE</span> seq_person</span><br><span class="line"><span class="keyword">MINVALUE</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">WITH</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">INCREMENT</span> <span class="keyword">BY</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">CACHE</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Persons (<span class="keyword">ID</span>,FirstName,LastName) <span class="keyword">VALUES</span> (seq_person.nextval,<span class="string">'Lars'</span>,<span class="string">'Monsen'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Access"><a href="#Access" class="headerlink" title="Access"></a>Access</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">P_Id <span class="built_in">int</span> PRIMARY <span class="keyword">KEY</span> AUTOINCREMENT,  <span class="comment">/* 使用AUTOINCREMENT(20,10)更改起始值和递增值 */</span></span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><blockquote>
<p><strong>Tips:</strong><br>索引能够提高 SELECT 查询和 WHERE 子句的速度，但是却降低了包含 UPDATE 语句或 INSERT 语句的数据输入过程的速度。<br>创建单列索引还是聚簇索引，要看每次查询中，哪些列在作为过滤条件的 WHERE 子句中最常出现。<br>如果只需要一列，那么就应当创建单列索引。如果作为过滤条件的 WHERE 子句用到了两个或者更多的列，那么聚簇索引就是最好的选择。</p>
</blockquote>
<p>CREATE INDEX index_name on table_name (column1, column2);</p>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>预定义的 SQL 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> CUSTOMERS_VIEW <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="keyword">name</span>, age <span class="keyword">FROM</span> CUSTOMERS <span class="keyword">WHERE</span> age <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> [<span class="keyword">WITH</span> <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>];</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> view_name <span class="keyword">AS</span> <span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> condition;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> view_name;</span><br></pre></td></tr></table></figure>
<h1 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">IF EXISTS (<span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">FROM</span> sysobjects <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'Proc_InsertEmployee'</span> <span class="keyword">AND</span> <span class="keyword">type</span> = <span class="string">'P'</span>) </span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> Proc_InsertEmployee </span><br><span class="line"><span class="keyword">GO</span> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> Proc_InsertEmployee </span><br><span class="line">@PName <span class="keyword">nvarchar</span>(<span class="number">50</span>), </span><br><span class="line">@PSex <span class="keyword">nvarchar</span>(<span class="number">4</span>), </span><br><span class="line">@PAge <span class="built_in">int</span>, </span><br><span class="line">@PWage money </span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line"><span class="keyword">declare</span> @PID <span class="keyword">nvarchar</span>(<span class="number">50</span>) </span><br><span class="line"><span class="keyword">select</span> @PID=<span class="keyword">Max</span>(员工编号) <span class="keyword">from</span> tb_Employee </span><br><span class="line"><span class="keyword">if</span>(@PID <span class="keyword">is</span> <span class="literal">null</span>) </span><br><span class="line"><span class="keyword">set</span> @PID=<span class="string">'P1001'</span> </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line"><span class="keyword">set</span> @PID=<span class="string">'P'</span>+<span class="keyword">cast</span>(<span class="keyword">cast</span>(<span class="keyword">substring</span>(@PID,<span class="number">2</span>,<span class="number">4</span>) <span class="keyword">as</span> <span class="built_in">int</span>)+<span class="number">1</span> <span class="keyword">as</span> <span class="keyword">nvarchar</span>(<span class="number">50</span>)) </span><br><span class="line"><span class="keyword">begin</span> </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_Employee <span class="keyword">values</span>(@PID,@PName,@PSex,@PAge,@PWage) </span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line"><span class="keyword">go</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 带输出参数 */</span></span><br><span class="line"><span class="keyword">CREATE</span> PROC PROC_EXISTS </span><br><span class="line">( </span><br><span class="line">@UserName <span class="keyword">NVARCHAR</span>(<span class="number">20</span>), </span><br><span class="line">@<span class="keyword">PassWord</span> <span class="keyword">NVARCHAR</span>(<span class="number">20</span>), </span><br><span class="line">@ReturnValue <span class="built_in">int</span> <span class="keyword">OUTPUT</span> </span><br><span class="line">) </span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">IF</span> <span class="keyword">EXISTS</span>(<span class="keyword">select</span> * <span class="keyword">from</span> tb_member <span class="keyword">where</span> userName=@UserName <span class="keyword">AND</span> <span class="keyword">passWord</span>=@<span class="keyword">PassWord</span>) </span><br><span class="line"><span class="keyword">set</span> @ReturnValue= <span class="number">100</span> </span><br><span class="line"><span class="keyword">ELSE</span> </span><br><span class="line"><span class="keyword">set</span> @ReturnValue= <span class="number">-100</span> </span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> @IsRight <span class="built_in">int</span> </span><br><span class="line">exec StuProc <span class="string">'赵雷'</span> , @IsRight <span class="keyword">output</span></span><br><span class="line"><span class="keyword">select</span> @IsRight</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Tips:</strong> 需要使用精确的时间时，使用LONG代替DATE，精确到毫秒。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/16/Druid/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/16/Druid/" itemprop="url">Druid</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-16T13:51:33+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/db/" itemprop="url" rel="index">
                    <span itemprop="name">db</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="SQL-Parser"><a href="#SQL-Parser" class="headerlink" title="SQL Parser"></a>SQL Parser</h1><h2 id="Parser"><a href="#Parser" class="headerlink" title="Parser"></a>Parser</h2><h3 id="Lexer词法分析"><a href="#Lexer词法分析" class="headerlink" title="Lexer词法分析"></a>Lexer词法分析</h3><p>Lexer中拥有词汇表，即Keywords。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Keywords keywods = Keywords.DEFAULT_KEYWORDS;</span><br></pre></td></tr></table></figure>
<p><code>DEFAULT_KEYWORDS</code>是一个Map&lt;String, Token&gt;，<code>Token</code>是词汇的枚举类，包含<code>SELECT\INSERT\FROM\WHERE</code>等。</p>
<p><code>nextToken()</code>从SQL语句解析出下一个单词。<br><code>token()</code>返回上一次解析的单词的Token类型。<br><code>stringVal()</code>获取标识符(Identifier)类型的值。</p>
<h3 id="Parser语法分析"><a href="#Parser语法分析" class="headerlink" title="Parser语法分析"></a>Parser语法分析</h3><p>在<code>SQLStatementParser</code>的<code>parseStatement</code>方法中通过调用<code>token()</code>方法，解析<code>SQLStatement</code>。如果Token类型为<code>SELECT</code>，则调用<code>parseSelect()</code>方法解析<code>SQLSelectStatement</code>。</p>
<h2 id="AST抽象语法树"><a href="#AST抽象语法树" class="headerlink" title="AST抽象语法树"></a>AST抽象语法树</h2><h3 id="节点类型"><a href="#节点类型" class="headerlink" title="节点类型"></a>节点类型</h3><ul>
<li>interface SQLObject {}</li>
<li><p>interface SQLExpr extends SQLObject {}</p>
<ul>
<li><p>interface SQLName extends SQLExpr {}</p>
<ul>
<li>class SQLIdentifierExpr implements SQLName  //如<code>ID = 3</code>的<code>ID</code></li>
<li>class SQLPropertyExpr implements SQLName  //如<code>A.ID = 3</code>的<code>A.ID</code></li>
</ul>
</li>
<li><p>class SQLBinaryOpExpr implements SQLExpr  //如<code>ID = 3</code>是一个SQLBinaryOpExpr，left是ID (SQLIdentifierExpr)，right是3 (SQLIntegerExpr)</p>
</li>
<li>class SQLIntegerExpr extends SQLNumericLiteralExpr implements SQLValuableExpr  //如<code>ID = 3</code>的<code>3</code>是一个SQLIntegerExpr</li>
<li>class SQLCharExpr extends SQLTextLiteralExpr implements SQLValuableExpr  //如<code>NAME = &#39;jobs&#39;</code>的<code>&#39;jobs&#39;</code>是一个SQLCharExpr</li>
</ul>
</li>
<li><p>interface SQLStatement extends SQLObject {}</p>
<ul>
<li>class SQLSelectStatement implements SQLStatement</li>
<li>class SQLUpdateStatement implements SQLStatement</li>
<li>class SQLDeleteStatement implements SQLStatement</li>
<li>class SQLInsertStatement implements SQLStatement</li>
</ul>
</li>
<li><p>class SQLCreateTableStatement extends SQLStatementImpl</p>
</li>
<li><p>interface SQLTableSource extends SQLObject {}</p>
<ul>
<li><p>class SQLTableSourceImpl extends SQLObjectImpl implements SQLTableSource</p>
<ul>
<li>class SQLExprTableSource extends SQLTableSourceImpl  //如<code>select * from emp where i = 3</code>，的<code>from emp</code>是一个SQLExprTableSource，其中<code>expr</code>是一个<code>name=emp</code>的SQLIdentifierExpr</li>
<li>class SQLJoinTableSource extends SQLTableSourceImpl  //如<code>select * from emp e inner join org o on e.org_id = o.id</code>，其中left <code>&#39;emp e&#39;</code> 是一个SQLExprTableSource，right <code>&#39;org o&#39;</code>也是一个SQLExprTableSource，condition <code>&#39;e.org_id = o.id&#39;</code>是一个SQLBinaryOpExpr</li>
<li>SQLSubqueryTableSource extends SQLTableSourceImpl  //如<code>select * from (select * from temp) a</code>，这里第一层<code>from(...)</code>是一个SQLSubqueryTableSource</li>
</ul>
</li>
</ul>
</li>
<li><p>class SQLSelect extends SQLObject {}</p>
</li>
<li>interface SQLSelectQuery extends SQLObject {}</li>
<li>class SQLSelectQueryBlock extends SQLObject {}</li>
<li>class SQLUnionQuery implements SQLSelectQuery</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> String dbType = JdbcConstants.MYSQL;  <span class="comment">//可以是ORACLE、POSTGRESQL、SQLSERVER、ODPS等</span></span><br><span class="line">String sql = <span class="string">"select * from t"</span>;</span><br><span class="line">List&lt;SQLStatement&gt; stmtList = SQLUtils.parseStatements(sql, dbType);  <span class="comment">//生成SQL语句</span></span><br><span class="line">SQLExpr expr = SQLUtils.toSQLExpr(<span class="string">"id=3"</span>, dbType);  <span class="comment">//生成表达式</span></span><br></pre></td></tr></table></figure>
<h2 id="Visitor"><a href="#Visitor" class="headerlink" title="Visitor"></a>Visitor</h2><ul>
<li>OutputVisitor用来把AST输出为字符串</li>
<li>WallVisitor分析SQL语意来防御SQL注入攻击</li>
<li>ParameterizedOutputVisitor用来合并未参数化的SQL进行统计</li>
<li>EvalVisitor用来对SQL表达式求值</li>
<li>ExportParameterVisitor用来提取SQL中的变量参数</li>
<li>SchemaStatVisitor用来统计SQL中使用的表、字段、过滤条件、排序表达式、分组表达式</li>
<li>SQL格式化 Druid内置了基于语义的SQL格式化功能</li>
</ul>
<h2 id="典型操作"><a href="#典型操作" class="headerlink" title="典型操作"></a>典型操作</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">"select * from user order by id"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新建 MySQL Parser</span></span><br><span class="line">SQLStatementParser parser = <span class="keyword">new</span> MySqlStatementParser(sql);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Parser解析生成AST，这里SQLStatement就是AST</span></span><br><span class="line">SQLStatement statement = parser.parseStatement();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用visitor来访问AST</span></span><br><span class="line">MySqlSchemaStatVisitor visitor = <span class="keyword">new</span> MySqlSchemaStatVisitor();</span><br><span class="line">statement.accept(visitor);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"getColumns:"</span> + visitor.getColumns());</span><br><span class="line">System.out.println(<span class="string">"getTables:"</span> + visitor.getTables());</span><br><span class="line">System.out.println(<span class="string">"getParameters:"</span> + visitor.getParameters());</span><br><span class="line">System.out.println(<span class="string">"getOrderByColumns:"</span> + visitor.getOrderByColumns());</span><br><span class="line">System.out.println(<span class="string">"getGroupByColumns:"</span> + visitor.getGroupByColumns());</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/alibaba/druid/wiki/SQL-Parser" target="_blank" rel="noopener">官方文档</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/08/MySQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/08/MySQL/" itemprop="url">MySQL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-08T11:58:45+08:00">
                2018-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/db/" itemprop="url" rel="index">
                    <span itemprop="name">db</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h1><p>schema：数据库，例如查询所有数据库名称和默认编码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select schema_name, default_character_set_name from information_schema.schemata;</span><br><span class="line"></span><br><span class="line">+<span class="comment">--------------------+----------------------------+</span></span><br><span class="line">| schema_name        | default_character_set_name |</span><br><span class="line">+<span class="comment">--------------------+----------------------------+</span></span><br><span class="line">| information_schema | utf8                       |</span><br><span class="line">| db_6922_0000       | latin1                     |</span><br><span class="line">| mysql              | latin1                     |</span><br><span class="line">| performance_schema | utf8                       |</span><br><span class="line">| sys                | utf8                       |</span><br><span class="line">+<span class="comment">--------------------+----------------------------+</span></span><br><span class="line">12 rows in <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure>
<h1 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ... */</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>/*! ... */</code> 仅在MySQL中执行。如：<code>/*! select * from user*/;</code><br><code>/*!50001 select * from user*/;</code> 仅在5.00.01以上的MySQL版本中执行。</p>
</blockquote>
<h1 id="information-schema数据库"><a href="#information-schema数据库" class="headerlink" title="information_schema数据库"></a>information_schema数据库</h1><h2 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h2><blockquote>
<ul>
<li>CHARACTER_SETS 字符集</li>
<li>COLLATIONS 字符集排序规则</li>
<li>COLLATION_CHARACTER_SET_APPLICABILITY</li>
</ul>
</blockquote>
<h2 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h2><blockquote>
<ul>
<li>SCHEMA_PRIVILEGES 数据库相关权限，mysql.db</li>
<li>TABLE_PRIVILEGES 表相关权限，mysql.tables_priv</li>
<li>COLUMN_PRIVILEGES 表授权的用户对象</li>
<li>USER_PRIVILEGES 用户相关权限，mysql.user<ul>
<li>Select_priv</li>
<li>Insert_priv</li>
<li>Update_priv</li>
<li>Delete_priv</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 新增用户，限制登录ip为10.155.123.%，%为通配符 */</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mysql.user(Host,<span class="keyword">User</span>,<span class="keyword">Password</span>) <span class="keyword">VALUES</span>(<span class="string">"10.155.123.%"</span>,<span class="string">"kaka"</span>,<span class="keyword">PASSWORD</span>(<span class="string">"kaka123"</span>));</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;  <span class="comment">/* 刷新系统权限相关表 */</span></span><br><span class="line">service mysqld restart  <span class="comment">/* 重启生效 */</span></span><br></pre></td></tr></table></figure>
<h3 id="权限分配"><a href="#权限分配" class="headerlink" title="权限分配"></a>权限分配</h3><p><code>GRANT 权限 ON 数据库.* TO 用户名@&#39;登录主机&#39; IDENTIFIED BY &#39;密码&#39;</code></p>
<ul>
<li>权限：<code>ALL,ALTER,CREATE,DROP,SELECT,UPDATE,DELETE</code></li>
<li>数据库：<code>*.*  表示所有库的所有表</code></li>
<li>用户名：<code>MySQL的账户名</code></li>
<li>登陆主机：<code>&#39;%&#39;表示所有ip</code></li>
<li>密码：<code>MySQL的账户名对应的登陆密码</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> test.user <span class="keyword">TO</span> kaka@<span class="string">'10.155.123.55'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">Grants</span> <span class="keyword">for</span> <span class="string">'kaka'</span>@<span class="string">'10.155.123.55'</span>;</span><br></pre></td></tr></table></figure>
<h2 id="实体对象"><a href="#实体对象" class="headerlink" title="实体对象"></a>实体对象</h2><blockquote>
<ul>
<li>COLUMNS 表字段</li>
<li>SCHEMATA 所有数据库及默认字符集</li>
</ul>
</blockquote>
<h1 id="MySQL协议"><a href="#MySQL协议" class="headerlink" title="MySQL协议"></a>MySQL协议</h1><h2 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h2><h3 id="Integers"><a href="#Integers" class="headerlink" title="Integers"></a>Integers</h3><h4 id="Fixed-length-integers"><a href="#Fixed-length-integers" class="headerlink" title="Fixed-length integers"></a>Fixed-length integers</h4><p>定长，例 int<3><br><code>01 00 00</code></3></p>
<h4 id="Length-encoded-integers"><a href="#Length-encoded-integers" class="headerlink" title="Length-encoded integers"></a>Length-encoded integers</h4><p>用第一个字节代表存储长度。例：</p>
<p><code>fa</code>       – 250<br><code>fc fb 00</code> – 251</p>
<ul>
<li>&lt;0xfb 1字节</li>
<li>0xfc 2字节</li>
<li>0xfd 3字节</li>
<li>0xfe 8字节</li>
</ul>
<h3 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h3><h4 id="FixedLengthString"><a href="#FixedLengthString" class="headerlink" title="FixedLengthString"></a>FixedLengthString</h4><p>定长，例 <code>string&lt;fix&gt;</code></p>
<h4 id="NulTerminatedString"><a href="#NulTerminatedString" class="headerlink" title="NulTerminatedString"></a>NulTerminatedString</h4><p><code>string&lt;NUL&gt;</code> ，以 <code>00</code> 结尾。</p>
<h4 id="VariableLengthString"><a href="#VariableLengthString" class="headerlink" title="VariableLengthString"></a>VariableLengthString</h4><p><code>string&lt;var&gt;</code></p>
<h4 id="LengthEncodedString"><a href="#LengthEncodedString" class="headerlink" title="LengthEncodedString"></a>LengthEncodedString</h4><p><code>string&lt;lenenc&gt;</code></p>
<h4 id="RestOfPacketString"><a href="#RestOfPacketString" class="headerlink" title="RestOfPacketString"></a>RestOfPacketString</h4><p><code>string&lt;EOF&gt;</code></p>
<h2 id="Packets"><a href="#Packets" class="headerlink" title="Packets"></a>Packets</h2><p>MySQL协议包被切分为最多2^24-1字节，每个分片携带包头。</p>
<h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3><table>
<thead>
<tr>
<th>Type</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>int<3></3></td>
<td>payload_length</td>
<td>payload长度</td>
</tr>
<tr>
<td>int<1></1></td>
<td>sequence_id</td>
<td>报文序列号</td>
</tr>
<tr>
<td>string<var></var></td>
<td>payload</td>
<td>payload</td>
</tr>
</tbody>
</table>
<p>例，<code>COM_QUIT</code>：</p>
<p><code>01 00 00 00 01</code></p>
<ul>
<li>length: 0x01</li>
<li>sequence_id: 0x00</li>
<li>payload: 0x01</li>
</ul>
<p><code>COM_QUERY</code>：</p>
<p><code>13 00 00 00 03 53 ...</code></p>
<ul>
<li>length: 0x13</li>
<li>sequence_id: 0x00</li>
<li>命令类型：0x03</li>
<li>命令：0x53 …</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://islibra.github.io/hello-islibra/hello-islibra/2018/09/08/UML/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiXiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/hello-islibra/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aaron's horizon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/hello-islibra/2018/09/08/UML/" itemprop="url">UML</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-08T11:56:17+08:00">
                2018-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hello-islibra/categories/design/" itemprop="url" rel="index">
                    <span itemprop="name">design</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h1><ul>
<li>类名</li>
<li>属性field</li>
<li>方法method</li>
</ul>
<h2 id="可见性"><a href="#可见性" class="headerlink" title="可见性"></a>可见性</h2><blockquote>
<p>public +<br>private -<br>protected #</p>
</blockquote>
<h2 id="完整表示"><a href="#完整表示" class="headerlink" title="完整表示"></a>完整表示</h2><p>可见性  名称 ：类型 [ = 缺省值]<br>可见性  名称(参数列表) [ ： 返回类型]</p>
<h2 id="类之间的关系"><a href="#类之间的关系" class="headerlink" title="类之间的关系"></a>类之间的关系</h2><h3 id="单向关联"><a href="#单向关联" class="headerlink" title="单向关联"></a>单向关联</h3><p>箭头 -&gt;</p>
<h3 id="双向关联"><a href="#双向关联" class="headerlink" title="双向关联"></a>双向关联</h3><p>直线 -</p>
<h3 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h3><p>空心菱形箭头 &lt;&gt;-&gt;</p>
<h3 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h3><p>实心菱形箭头 &lt;*&gt;-&gt;</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p>虚线箭头 —&gt;</p>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>空心三角 -|&gt;</p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>虚线空心三角 —|&gt;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/hello-islibra/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/hello-islibra/">1</a><span class="page-number current">2</span><a class="page-number" href="/hello-islibra/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/hello-islibra/page/7/">7</a><a class="extend next" rel="next" href="/hello-islibra/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">LiXiaolong</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/hello-islibra/archives/">
              
                  <span class="site-state-item-count">62</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LiXiaolong</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/hello-islibra/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/hello-islibra/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/hello-islibra/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/hello-islibra/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/hello-islibra/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/hello-islibra/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/hello-islibra/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/hello-islibra/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/hello-islibra/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
