<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>SSL - My Docs</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "SSL";
    var mkdocs_page_input_path = "coding\\java\\SSL.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> My Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../../..">README</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Cloud</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">Ai</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../cloud/ai/AI/">AI</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../cloud/ai/softcom_plus_ai/">softcom</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Container</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../cloud/container/Kubenetes常用命令/">Kubenetes常用命令</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../cloud/container/Kubenetes网络/">Kubenetes网络</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../cloud/container/docker常用命令/">docker常用命令</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Openstack</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../cloud/openstack/架构/">keystone</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../cloud/openstack/虚拟化/">虚拟化</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Coding</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">Db</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../db/Druid/">Druid</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../db/MongoDB/">MongoDB</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../db/MySQL/">MySQL</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../db/SQL/">SQL</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../db/SQL基本数据类型/">SQL基本数据类型</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../db/Ubuntu16.04安装mysql5.7.23/">Ubuntu16.04安装mysql5.7.23</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../db/mybatis/">Mybatis</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Go</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../go/go/">Go</a>
                </li>
    </ul>
                </li>
                <li class=" current">
                    
    <span class="caption-text">Java</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../AIO/">AIO</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../Annotation/">Annotation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../Jackson/">Jackson</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../Java8 Stream/">Java8 Stream</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../Java单元测试/">Java单元测试</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../Java基本数据类型/">Java基本数据类型</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../Java排序/">Java排序</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../Java数据类型转换/">Java数据类型转换</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../Java读取properties配置文件/">Java读取properties配置文件</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../Java运算符/">Java运算符</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../Lambda表达式/">Lambda表达式</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../Linux设置Java环境变量/">Linux设置Java环境变量</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../NIO/">NIO</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../Netty/">Netty</a>
                </li>
                <li class="toctree-l3 current">
                    
    <a class="current" href="./">SSL</a>
    <ul class="subnav">
            
    <li class="toctree-l4"><a href="#x509">X.509证书</a></li>
    
        <ul>
        
            <li><a class="toctree-l5" href="#_1">结构</a></li>
        
            <li><a class="toctree-l5" href="#_2">获取方式</a></li>
        
        </ul>
    

    <li class="toctree-l4"><a href="#keytool">Keytool</a></li>
    
        <ul>
        
            <li><a class="toctree-l5" href="#keystorejks">创建keystore.jks</a></li>
        
            <li><a class="toctree-l5" href="#truststorejks">创建truststore.jks</a></li>
        
        </ul>
    

    <li class="toctree-l4"><a href="#opensslhttpwwwopensslorg">OpenSSL，http://www.openssl.org</a></li>
    

    <li class="toctree-l4"><a href="#serverxml">配置server.xml</a></li>
    

    <li class="toctree-l4"><a href="#java">修改Java启动参数</a></li>
    

    <li class="toctree-l4"><a href="#tls">TLS协商过程</a></li>
    

    <li class="toctree-l4"><a href="#_3">证书校验过程</a></li>
    

    </ul>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../jar/">jar</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../使用HttpClient发送HTTPS请求/">使用HttpClient发送HTTPS请求</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../字符编码/">字符编码</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../序列化/">序列化</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../深入理解JVM/">深入理解JVM</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../线程池/">线程池</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../远程调试/">远程调试</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../那些年踩过的坑/">那些年踩过的坑</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../锁/">锁</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Javascript</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../javascript/Node.js/">Node.js</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../javascript/Vue.js/">Vue.js</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Python</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../python/6_io/">文件读写</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/7_异常/">7 异常</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/8_类/">8 类</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/datatype/">字符串</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/operator/">逻辑/成员/身份运算符</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/python/">安装</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/subprocess/">参数列表</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/函数/">函数</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/库函数/">库函数</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/模块/">导入</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/流程控制/">if</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/迭代器生成器/">迭代器生成器</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Springboot</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../springboot/注解/">注解</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Web</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../web/HTTP错误码/">HTTP错误码</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../web/LVS转发问题抓包定位/">LVS转发问题抓包定位</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../web/URL归一化/">前置条件</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../web/curl/">curl</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../web/http响应头/">Content-Security-Policy</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../web/nginx/">架构</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../web/短网址/">短网址算法</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Writing</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../writing/Markdown/">Markdown</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../writing/atom/">atom</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../writing/mkdocs/">Welcome to MkDocs</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../writing/使用Hexo搭建个人博客/">使用Hexo搭建个人博客</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Design</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../design/UML/">UML</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../design/优化/">优化</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../design/正则表达式/">正则表达式</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Data structure</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../design/data_structure/balance_tree/">Balance tree</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../design/data_structure/red_black_tree/">二叉查找树</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../design/data_structure/堆/">最大堆</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../design/data_structure/查找排序/">二分查找</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../design/data_structure/算法图解/">广度优先搜索解决无权图的最短路径问题</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Environment</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">Net</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/net/私网IP地址范围/">私网IP地址范围</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Os</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/Linux中sh和bash的区别/">Linux中sh和bash的区别</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/Linux基本命令/">Linux基本命令</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/Linux文件系统/">Linux文件系统</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/Linux用户管理/">Linux用户管理</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/Linux磁盘管理/">Linux磁盘管理</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/Linux系统管理/">Linux系统管理</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/Linux网络管理/">Linux网络管理</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/Linux软件管理/">Linux软件管理</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/Tips/">Tips</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/grep&awk/">grep&awk</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/sudoers文件/">sudoers文件</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/vim/">vim</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/windows/">重启</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/查看操作系统版本/">操作系统发行版</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/os/设置ssh连接不超时/">设置ssh连接不超时</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Tools</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/tools/Git常用命令/">Git常用命令</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/tools/Maven/">Maven</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/tools/Notepad++/">Notepad++</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/tools/创建VPN/">创建VPN</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/tools/将TAB转换为4个空格/">将TAB转换为4个空格</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/tools/工具/">工具</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/tools/开发环境初始化/">开发环境初始化</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/tools/快捷键/">快捷键</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../environment/tools/搜狗输入法自定义短语/">搜狗输入法自定义短语</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Other</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../other/links/">网络安全</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../other/买房的事情/">买房的事情</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../other/班车/">班车</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../other/语录/">语录</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Dts</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../other/dts/SVN：Previous operation has not finished; run 'cleanup' if it was interrupted/">SVN：Previous operation has not finished; run 'cleanup' if it was interrupted</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../other/dts/git clone时报Please make sure you have the correct access rights and the repository exists/">问题现象</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../other/dts/hsts/">问题现象</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Security</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../security/OpenSSL/">1. 标准命令</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../security/google_search/">Google search</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../security/远程调用中的反序列化注入/">RMI</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">My Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>Java &raquo;</li>
        
      
        
          <li>Coding &raquo;</li>
        
      
    
    <li>SSL</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>通过SSL协议保护client和server之间的通信，包含1. 服务端认证、2. 客户端认证和3. 通信数据加密，例：<code>https://www.onlinebooks.com/creditcardinfo.html</code>。<br />
最新的协议版本：TLS。<br />
认证过程通过公私钥对机制，owner对外发布公钥，并通过 <strong>X.509证书</strong> 来证明是该公钥的owner，保留私钥。  </p>
<h1 id="x509">X.509证书</h1>
<h2 id="_1">结构</h2>
<ul>
<li>data: public key owner的DN(Distinguished Name), certificate issuer的DN, 有效期，public key  </li>
<li>signature  </li>
</ul>
<h2 id="_2">获取方式</h2>
<ol>
<li>通过CA(Certificate Authority)，例VeriSign。证书颁发机构具有层级，root CA的证书自签名，下层颁发机构的证书由上层机构签名，由此构成certificate chain。  </li>
<li>自签名：owner和issuer相同。  </li>
</ol>
<h1 id="keytool">Keytool</h1>
<p>存在于jre的bin目录下，用来管理keystore/truststore。  </p>
<p>keystore，客户端认证使用，主要用来存储：<br />
1. private key和与public key相关的客户端certificate chain
1. trusted certificates</p>
<p>truststore，在SSL协议中认证服务器使用，只用来存储trusted CA root self-signed certificates。  </p>
<p>向keystore中添加entity时需要指定全局唯一的alias。<br />
常见用法：<br />
- 生成密钥对：<code>-genkeypair</code>，若keystore不存在则自动创建。<br />
- 生成证书请求：<code>-certreq</code><br />
- 导入证书或证书链：<code>-importcert</code>，若keystore不存在则自动创建。<br />
- 导出证书：<code>-exportcert</code><br />
- 列出keystore中的条目：<code>-list</code></p>
<h2 id="keystorejks">创建keystore.jks</h2>
<pre><code class="bash">#生成密钥并在当前目录自动生成名为clientkeystore的JKS格式keystore文件。
$ keytool -keystore clientkeystore -genkey -alias client
输入密钥库口令:
再次输入新口令:
您的名字与姓氏是什么?
  [Unknown]:  Aaron
您的组织单位名称是什么?
  [Unknown]:  PAAS
您的组织名称是什么?
  [Unknown]:  IT
您所在的城市或区域名称是什么?
  [Unknown]:  Shenzhen
您所在的省/市/自治区名称是什么?
  [Unknown]:  Guangdong
该单位的双字母国家/地区代码是什么?
  [Unknown]:  CN
CN=Aaron, OU=PAAS, O=IT, L=Shenzhen, ST=Guangdong, C=CN是否正确?
  [否]:  y

输入 &lt;client&gt; 的密钥口令
        (如果和密钥库口令相同, 按回车):

#生成证书请求文件client.csr（PEM格式）
$ keytool -keystore clientkeystore -certreq -alias client -keyalg rsa -file client.csr
#将CSR发送给CA，由CA颁发使用CA私钥签名证书。
#导入CA颁发的证书，client.cer中包含客户端证书和CARoot.cer
$ keytool -import -keystore clientkeystore -file client.cer -alias client
#或单独导入CA证书
$ keytool -import -keystore clientkeystore -file CARoot.cer -alias theCARoot

########

#生成密钥对和自签名证书
$ keytool -genkey -keyalg RSA -alias CAPS -keystore keystore_filename
#导出自签名证书
$ keytool -export -alias CAPS -keystore keystore_filename -rfc -file self_signed_cert_filename
#导入信任的CA证书
$ keytool -import -trustcacerts -alias CAPS -file ca-certificate-filename -keystore keystore_filename
</code></pre>

<blockquote>
<p><strong>Tips:</strong> 某些CA会校验first and last name是否为正确的domain。</p>
</blockquote>
<h2 id="truststorejks">创建truststore.jks</h2>
<pre><code class="bash">#在当前目录生成myTrustStore，将信任的CA证书通过别名firstCA导入到truststore
$ keytool -import -file C:\cascerts\firstCA.cert -alias firstCA -keystore myTrustStore
</code></pre>

<h1 id="opensslhttpwwwopensslorg">OpenSSL，http://www.openssl.org</h1>
<p>SSL/TLS协议的开源实现，可用命令：<br />
- pkcs12，解析或生成PKCS #12文件<br />
- req，创建或处理证书请求（PKCS #10格式）  </p>
<p>PKCS #12，keystore存档文件格式，扩展名.p12或.pfx，在一个文件中存储多个加密对象，通常打包一个私钥及有关的X.509证书，文件本身也是加密的。<br />
通过OpenSSL的<code>openssl pkcs12 [options]</code>命令创建/解析，例：<br />
- 解析p12文件并输出证书：<code>openssl pkcs12 -in file.p12 -out file.pem</code><br />
- 仅输出客户端证书：<code>openssl pkcs12 -in file.p12 -clcerts -out file.pem</code><br />
- 不加密私钥：<code>openssl pkcs12 -in file.p12 -out file.pem -nodes</code><br />
- 创建p12文件：<code>openssl pkcs12 -export -in file.pem -out file.p12 -name "My Certificate"</code>，file.pem包含私钥和证书。<br />
- 添加多个证书：<code>openssl pkcs12 -export -in file.pem -out file.p12 -name "My Certificate" -certfile othercerts.pem</code><br />
- 创建CA证书：<code>openssl  req  -config c:\openssl\bin\openssl.cnf -new  -x509  -keyout  ca-key.pem.txt -out  ca-certificate.pem.txt  -days  365</code><br />
- 使用CA证书签名服务器证书：<code>openssl  x509  -req  -CA ca-certificate.pem.txt -CAkey ca-key.pem.txt -in client.csr -out client.cer  -days 365  -CAcreateserial</code>  </p>
<blockquote>
<p><strong>Tips:</strong> keytool只能读取pkcs12（在export时添加-noiter -nomaciter），无法写入。</p>
</blockquote>
<h1 id="serverxml">配置server.xml</h1>
<p>修改Connector中的keystoreFile和keystorePass，如：</p>
<pre><code class="xml">&lt;Connector port=&quot;8443&quot;
   maxThreads=&quot;150&quot; minSpareThreads=&quot;25&quot; maxSpareThreads=&quot;75&quot;
   enableLookups=&quot;false&quot; disableUploadTimeout=&quot;true&quot;
   keystoreFile=&quot;C:\JavaCAPS6\keystore\keystore.jks&quot;
   keystorePass=&quot;changeit&quot;
   acceptCount=&quot;100&quot; debug=&quot;0&quot; scheme=&quot;https&quot; secure=&quot;true&quot;
   clientAuth=&quot;false&quot; sslProtocol=&quot;TLS&quot; /&gt;
</code></pre>

<h1 id="java">修改Java启动参数</h1>
<p>增加truststore路径，如：<code>set JAVA_OPTS=-Xmx512m -Djavax.net.ssl.trustStore=C:\JavaCAPS\keystore\cacerts.jks</code></p>
<h1 id="tls">TLS协商过程</h1>
<ol>
<li>客户端发出请求（ClientHello）：携带支持的协议版本如TLSv1.2，支持的加密算法如ECDHE&amp;RSAwithAES128GCM&amp;SHA256，随机数1，[请求域名]。  </li>
<li>服务器响应（ServerHello）：确认使用的加密通信协议版本如TLSv1.2，使用的加密算法如RSAwithAES128GCM&amp;SHA256，服务器证书，随机数2，[客户端证书请求，如金融机构请求提供USB-KEY中的客户端证书]，[session ID/session ticket(encrypted session key)]。  </li>
<li>客户端响应：验证服务器证书（通过客户端保存的可信CA列表中证书公钥解密服务器证书中的签名，证书中的域名和实际域名是否一致，证书是否过期），取出服务器证书中的公钥加密随机数3(pre-master secret)，加密通信隧道通知，握手结束通知（所有内容HASH），[客户端证书]。之后使用三个随机数生成对称密钥R。  </li>
<li>[校验客户端证书]，接收到加密随机数3，使用私钥解密，使用三个随机数生成对称密钥R。发出加密通信隧道通知，握手结束通知（所有内容的HASH）。</li>
</ol>
<h1 id="_3">证书校验过程</h1>
<ol>
<li>取上级证书的公钥，对下级证书的签名进行解密，得出下级证书的摘要digest1  </li>
<li>对下级证书进行信息摘要digest2  </li>
<li>判断digest1和digest2是否相等  </li>
<li>依次对各级相邻证书校验，直到root CA或可信锚点  </li>
</ol>
<p>参考：<a href="https://docs.oracle.com/cd/E19509-01/820-3503/index.html">https://docs.oracle.com/cd/E19509-01/820-3503/index.html</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../jar/" class="btn btn-neutral float-right" title="jar">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Netty/" class="btn btn-neutral" title="Netty"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../Netty/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../jar/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>

</body>
</html>
